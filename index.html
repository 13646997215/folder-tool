<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta
      name="description"
      content="‰∏ì‰∏öÁöÑÊñá‰ª∂Â§πÁªìÊûÑÂàÜÊûêÂ∑•ÂÖ∑,ÊîØÊåÅÂ§öÁßçÂØºÂá∫Ê†ºÂºè"
    />
    <meta name="keywords" content="Êñá‰ª∂Â§πÂàÜÊûê,ÁõÆÂΩïÊ†ë,Êñá‰ª∂ÁÆ°ÁêÜ,ÂØºÂá∫Â∑•ÂÖ∑" />
    <meta name="author" content="Folder Analyzer Pro" />
    <!-- Á¶ÅÊ≠¢Ëá™Âä®ËØÜÂà´ÁîµËØù/ÈÇÆÁÆ±ÔºàÂæÆ‰ø°ÂÖºÂÆπÔºâ -->
    <meta name="format-detection" content="telephone=no,email=no,address=no" />

    <!-- ÁßªÂä®Á´Ø‰ºòÂåñ -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Êñá‰ª∂Â§πÂàÜÊûê" />

    <!-- Favicon -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìä</text></svg>"
    />

    <title>Êñá‰ª∂Â§πÁªìÊûÑÂàÜÊûêÂ∑•ÂÖ∑ Pro</title>

    <style>
      /* ==================== CSSÂèòÈáèÁ≥ªÁªü ==================== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        /* Morandi ‰∏ªÈ¢ò */
        --primary-color: #a4b5d5;
        --secondary-color: #eabcdd;
        --accent-color: #ddd1e9;
        --bg-color: #f7f6f5;
        --bg-gradient: linear-gradient(135deg, #f7f6f5 0%, #f0dfea 100%);
        --text-color: #5a5a5a;
        --text-light: #888;
        --text-lighter: #aaa;
        --border-color: #ddd1e9;
        --shadow: 0 4px 15px rgba(164, 181, 213, 0.15);
        --shadow-hover: 0 6px 20px rgba(164, 181, 213, 0.25);
        --shadow-card: 0 2px 8px rgba(164, 181, 213, 0.1);

        /* ÂÆâÂÖ®Âå∫Âüü */
        --safe-area-top: env(safe-area-inset-top, 0px);
        --safe-area-right: env(safe-area-inset-right, 0px);
        --safe-area-bottom: env(safe-area-inset-bottom, 0px);
        --safe-area-left: env(safe-area-inset-left, 0px);

        /* Â∏ÉÂ±ÄÂèòÈáè */
        --sidebar-width: 320px;
        --header-height: 80px;
        --border-radius: 12px;
        --border-radius-lg: 20px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

        /* Èó¥Ë∑ù */
        --spacing-xs: 5px;
        --spacing-sm: 10px;
        --spacing-md: 15px;
        --spacing-lg: 20px;
        --spacing-xl: 30px;
      }

      /* Ê∑±Ëâ≤‰∏ªÈ¢ò */
      [data-theme="dark"] {
        --primary-color: #6b7fa8;
        --secondary-color: #b88bad;
        --accent-color: #9b8ba8;
        --bg-color: #2c2c2c;
        --bg-gradient: linear-gradient(135deg, #2c2c2c 0%, #3a3a3a 100%);
        --text-color: #e0e0e0;
        --text-light: #a0a0a0;
        --text-lighter: #808080;
        --border-color: #4a4a4a;
        --shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        --shadow-hover: 0 6px 20px rgba(0, 0, 0, 0.4);
        --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      /* ÊµÖËâ≤‰∏ªÈ¢ò */
      [data-theme="light"] {
        --primary-color: #5b9bd5;
        --secondary-color: #ed7d31;
        --accent-color: #70ad47;
        --bg-color: #ffffff;
        --bg-gradient: linear-gradient(135deg, #ffffff 0%, #f5f5f5 100%);
        --text-color: #333333;
        --text-light: #666666;
        --text-lighter: #999999;
        --border-color: #e0e0e0;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        --shadow-hover: 0 4px 15px rgba(0, 0, 0, 0.15);
        --shadow-card: 0 1px 4px rgba(0, 0, 0, 0.08);
      }

      /* ÂΩ©Ëôπ‰∏ªÈ¢ò */
      [data-theme="rainbow"] {
        --primary-color: #ff6b9d;
        --secondary-color: #ffa07a;
        --accent-color: #87ceeb;
        --bg-color: #fff5f7;
        --bg-gradient: linear-gradient(135deg, #fff5f7 0%, #e6f3ff 100%);
        --text-color: #444444;
        --text-light: #777777;
        --text-lighter: #aaaaaa;
        --border-color: #ffb6c1;
        --shadow: 0 4px 15px rgba(255, 107, 157, 0.2);
        --shadow-hover: 0 6px 20px rgba(255, 107, 157, 0.3);
        --shadow-card: 0 2px 8px rgba(255, 107, 157, 0.15);
      }

      /* ==================== ÂÖ®Â±ÄÊ†∑Âºè ==================== */
      html {
        font-size: 16px;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC",
          "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
        background: var(--bg-gradient);
        min-height: 100vh;
        color: var(--text-color);
        transition: var(--transition);
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        line-height: 1.6;
      }

      /* Èò≤Ê≠¢ÂèåÂáªÁº©Êîæ */
      * {
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      /* ÈÄâ‰∏≠ÊñáÊú¨Ê†∑Âºè */
      ::selection {
        background: var(--primary-color);
        color: white;
      }

      /* ÊªöÂä®Êù°Ê†∑Âºè */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(164, 181, 213, 0.1);
        border-radius: 5px;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 5px;
        transition: var(--transition);
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--primary-color);
      }

      /* ==================== Â∏ÉÂ±ÄÂÆπÂô® ==================== */
      .app-wrapper {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        padding: var(--spacing-lg);
        padding-top: calc(var(--spacing-lg) + var(--safe-area-top));
        padding-bottom: calc(var(--spacing-lg) + var(--safe-area-bottom));
        padding-left: calc(var(--spacing-lg) + var(--safe-area-left));
        padding-right: calc(var(--spacing-lg) + var(--safe-area-right));
      }

      .app-container {
        max-width: 1400px;
        width: 100%;
        margin: 0 auto;
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: var(--spacing-lg);
      }

      /* ==================== Â§¥ÈÉ®Âå∫Âüü ==================== */
      .header {
        background: var(--bg-color);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow);
        padding: var(--spacing-xl);
        transition: var(--transition);
      }

      .header:hover {
        box-shadow: var(--shadow-hover);
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: var(--spacing-lg);
        flex-wrap: wrap;
      }

      .logo-section {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        flex: 1;
        min-width: 250px;
      }

      .logo-icon {
        font-size: 48px;
        line-height: 1;
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      .logo-text {
        flex: 1;
      }

      .logo-title {
        font-size: 28px;
        font-weight: 300;
        color: var(--primary-color);
        letter-spacing: 1px;
        margin-bottom: var(--spacing-xs);
        line-height: 1.2;
      }

      .logo-subtitle {
        font-size: 13px;
        color: var(--text-light);
        letter-spacing: 0.5px;
      }

      .header-actions {
        display: flex;
        gap: var(--spacing-sm);
        align-items: center;
      }

      .theme-switcher {
        display: flex;
        gap: 8px;
        background: rgba(164, 181, 213, 0.1);
        padding: 5px;
        border-radius: var(--border-radius);
      }

      .theme-btn {
        width: 40px;
        height: 40px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 20px;
        transition: var(--transition);
        background: transparent;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .theme-btn:hover {
        transform: scale(1.1);
        background: rgba(164, 181, 213, 0.15);
      }

      .theme-btn:active {
        transform: scale(0.95);
      }

      .theme-btn.active {
        background: var(--primary-color);
        box-shadow: var(--shadow-card);
      }

      /* ==================== ‰∏ªÂÜÖÂÆπÂ∏ÉÂ±Ä ==================== */
      .main-layout {
        display: grid;
        grid-template-columns: var(--sidebar-width) 1fr;
        gap: var(--spacing-lg);
        flex: 1;
        align-items: start;
      }

      /* ==================== ‰æßËæπÊ†è ==================== */
      .sidebar {
        background: var(--bg-color);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow);
        padding: var(--spacing-lg);
        position: sticky;
        top: var(--spacing-lg);
        max-height: calc(100vh - var(--spacing-lg) * 2);
        overflow-y: auto;
        overflow-x: hidden;
        transition: var(--transition);
      }

      .sidebar:hover {
        box-shadow: var(--shadow-hover);
      }

      .sidebar-section {
        margin-bottom: var(--spacing-lg);
        padding-bottom: var(--spacing-lg);
        border-bottom: 1px solid var(--border-color);
      }

      .sidebar-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
      }

      .section-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: var(--spacing-md);
        display: flex;
        align-items: center;
        gap: 8px;
        letter-spacing: 0.5px;
      }

      .section-icon {
        font-size: 18px;
      }

      /* ==================== ÊåâÈíÆÊ†∑Âºè ==================== */
      .btn {
        padding: 12px 20px;
        border: none;
        border-radius: var(--border-radius);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-decoration: none;
        user-select: none;
        white-space: nowrap;
      }

      .btn:active {
        transform: scale(0.98);
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--accent-color)
        );
        color: white;
        box-shadow: var(--shadow-card);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
      }

      .btn-secondary {
        background: rgba(164, 181, 213, 0.1);
        color: var(--text-color);
        border: 1px solid var(--border-color);
      }

      .btn-secondary:hover {
        background: rgba(164, 181, 213, 0.2);
        border-color: var(--primary-color);
      }

      .btn-full {
        width: 100%;
      }

      .btn-icon {
        font-size: 18px;
      }

      /* ==================== ËæìÂÖ•Ê°ÜÊ†∑Âºè ==================== */
      .input {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 14px;
        background: var(--bg-color);
        color: var(--text-color);
        transition: var(--transition);
        font-family: inherit;
      }

      .input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(164, 181, 213, 0.1);
      }

      .input::placeholder {
        color: var(--text-light);
      }

      .input-number {
        width: 80px;
        text-align: center;
      }

      /* ==================== Â§çÈÄâÊ°ÜÊ†∑Âºè ==================== */
      .checkbox-wrapper {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
        user-select: none;
      }

      .checkbox-wrapper:hover {
        background: rgba(164, 181, 213, 0.05);
      }

      .checkbox {
        width: 18px;
        height: 18px;
        cursor: pointer;
        accent-color: var(--primary-color);
      }

      .checkbox-label {
        font-size: 13px;
        color: var(--text-color);
        cursor: pointer;
        flex: 1;
      }

      /* ==================== ËøáÊª§Âô®Ê†∑Âºè ==================== */
      .filter-group {
        margin-bottom: var(--spacing-md);
      }

      .filter-label {
        font-size: 13px;
        color: var(--text-color);
        margin-bottom: 8px;
        display: block;
        font-weight: 500;
      }

      .filter-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .filter-tag {
        padding: 6px 14px;
        background: rgba(164, 181, 213, 0.1);
        border-radius: 20px;
        font-size: 12px;
        color: var(--text-color);
        cursor: pointer;
        transition: var(--transition);
        border: 1px solid transparent;
        user-select: none;
        white-space: nowrap;
      }

      .filter-tag:hover {
        background: rgba(164, 181, 213, 0.2);
        transform: translateY(-1px);
      }

      .filter-tag:active {
        transform: translateY(0);
      }

      .filter-tag.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
        box-shadow: var(--shadow-card);
      }

      .size-range {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .size-range .input {
        flex: 1;
        min-width: 0;
      }

      .size-range-separator {
        color: var(--text-light);
        font-weight: 500;
      }

      /* ==================== ÁªüËÆ°Âç°Áâá ==================== */
      .stats-wrapper {
        overflow-x: auto;
        overflow-y: hidden;
        margin-bottom: var(--spacing-lg);
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
      }

      .stats-wrapper::-webkit-scrollbar {
        height: 6px;
      }

      .stats-wrapper::-webkit-scrollbar-track {
        background: rgba(164, 181, 213, 0.1);
        border-radius: 3px;
      }

      .stats-wrapper::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border-radius: 3px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: var(--spacing-md);
        min-width: min-content;
      }

      .stat-card {
        background: linear-gradient(
          135deg,
          rgba(164, 181, 213, 0.08),
          rgba(234, 188, 221, 0.08)
        );
        border-radius: var(--border-radius);
        padding: var(--spacing-md);
        text-align: center;
        transition: var(--transition);
        border: 1px solid var(--border-color);
      }

      .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-card);
        border-color: var(--primary-color);
      }

      .stat-icon {
        font-size: 32px;
        margin-bottom: 8px;
        display: block;
      }

      .stat-value {
        font-size: 24px;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 5px;
        line-height: 1;
      }

      .stat-label {
        font-size: 11px;
        color: var(--text-light);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* ==================== ËßÜÂõæÊ®°ÂºèÂàáÊç¢ ==================== */
      .view-modes {
        display: flex;
        gap: 8px;
        background: rgba(164, 181, 213, 0.1);
        padding: 5px;
        border-radius: var(--border-radius);
      }

      .view-mode-btn {
        flex: 1;
        padding: 10px 16px;
        background: transparent;
        border: none;
        border-radius: 8px;
        font-size: 13px;
        color: var(--text-color);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        user-select: none;
        white-space: nowrap;
      }

      .view-mode-btn:hover {
        background: rgba(164, 181, 213, 0.15);
      }

      .view-mode-btn:active {
        transform: scale(0.95);
      }

      .view-mode-btn.active {
        background: var(--primary-color);
        color: white;
        box-shadow: var(--shadow-card);
      }

      .view-mode-icon {
        font-size: 16px;
      }

      /* ==================== ÊêúÁ¥¢Ê†è ==================== */
      .search-bar {
        display: flex;
        align-items: center;
        gap: 10px;
        background: var(--bg-color);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 10px 15px;
        transition: var(--transition);
        margin-bottom: var(--spacing-lg);
      }

      .search-bar:focus-within {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(164, 181, 213, 0.1);
      }

      .search-icon {
        color: var(--text-light);
        font-size: 18px;
      }

      .search-input {
        flex: 1;
        border: none;
        outline: none;
        font-size: 14px;
        background: transparent;
        color: var(--text-color);
        font-family: inherit;
      }

      .search-input::placeholder {
        color: var(--text-light);
      }

      .search-clear {
        background: none;
        border: none;
        color: var(--text-light);
        cursor: pointer;
        font-size: 20px;
        padding: 0;
        width: 24px;
        height: 24px;
        display: none;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: var(--transition);
      }

      .search-clear:hover {
        background: rgba(164, 181, 213, 0.1);
        color: var(--text-color);
      }

      .search-clear.active {
        display: flex;
      }

      /* ==================== ‰∏ªÂÜÖÂÆπÂå∫Âüü ==================== */
      .content-area {
        background: var(--bg-color);
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow);
        padding: var(--spacing-xl);
        min-height: 600px;
        display: flex;
        flex-direction: column;
        transition: var(--transition);
      }

      .content-area:hover {
        box-shadow: var(--shadow-hover);
      }

      .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: var(--spacing-lg);
        gap: var(--spacing-md);
        flex-wrap: wrap;
      }

      /* ==================== Êñá‰ª∂Â§π‰ø°ÊÅØ ==================== */
      .folder-info {
        background: linear-gradient(
          135deg,
          rgba(164, 181, 213, 0.1),
          rgba(234, 188, 221, 0.1)
        );
        border-radius: var(--border-radius);
        padding: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
        border: 1px solid var(--border-color);
        display: none;
        transition: var(--transition);
      }

      .folder-info.active {
        display: block;
        animation: slideDown 0.3s ease;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .folder-name {
        font-size: 16px;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .folder-stats {
        font-size: 13px;
        color: var(--text-light);
      }

      /* ==================== Âø´ÈÄüÊìç‰ΩúÊåâÈíÆ ==================== */
      .quick-actions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 10px;
        margin-bottom: var(--spacing-lg);
      }

      .quick-btn {
        padding: 12px 16px;
        background: rgba(164, 181, 213, 0.1);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 13px;
        color: var(--text-color);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        user-select: none;
        white-space: nowrap;
      }

      .quick-btn:hover {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: var(--shadow-card);
      }

      .quick-btn:active {
        transform: translateY(0);
      }

      .quick-btn-icon {
        font-size: 16px;
      }

      /* ==================== È¢ÑËßàÂÆπÂô® ==================== */
      .preview-container {
        flex: 1;
        min-height: 400px;
        position: relative;
      }

      .empty-state {
        text-align: center;
        padding: 80px 20px;
        color: var(--text-light);
      }

      .empty-icon {
        font-size: 80px;
        margin-bottom: 20px;
        opacity: 0.5;
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.5;
        }
        50% {
          opacity: 0.3;
        }
      }

      .empty-title {
        font-size: 18px;
        margin-bottom: 10px;
        color: var(--text-color);
        font-weight: 500;
      }

      .empty-text {
        font-size: 14px;
        color: var(--text-light);
      }

      /* ==================== Ê†ëÂΩ¢ËßÜÂõæ ==================== */
      .tree-view {
        font-family: "Courier New", "Consolas", monospace;
        font-size: 13px;
        line-height: 1.8;
        white-space: pre;
        overflow-x: auto;
        padding: var(--spacing-lg);
        background: rgba(164, 181, 213, 0.03);
        border-radius: var(--border-radius);
        max-height: 600px;
        overflow-y: auto;
      }

      .tree-item {
        transition: var(--transition);
        cursor: pointer;
        display: block;
      }

      .tree-item:hover {
        background: rgba(164, 181, 213, 0.1);
        margin-left: -5px;
        padding-left: 5px;
        border-radius: 4px;
      }

      .tree-folder {
        color: var(--primary-color);
        font-weight: 600;
      }

      .tree-file {
        color: var(--text-color);
      }

      .highlight {
        background: linear-gradient(135deg, #ffd700, #ffed4e);
        color: #000;
        padding: 2px 4px;
        border-radius: 3px;
        font-weight: 600;
      }

      /* ==================== ÂàóË°®ËßÜÂõæ ==================== */
      .list-view {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .list-item {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        background: rgba(164, 181, 213, 0.03);
        border-radius: var(--border-radius);
        transition: var(--transition);
        cursor: pointer;
        gap: 12px;
      }

      .list-item:hover {
        background: rgba(164, 181, 213, 0.1);
        transform: translateX(5px);
        box-shadow: var(--shadow-card);
      }

      .list-item-icon {
        font-size: 24px;
        flex-shrink: 0;
      }

      .list-item-info {
        flex: 1;
        min-width: 0;
      }

      .list-item-name {
        font-size: 14px;
        color: var(--text-color);
        margin-bottom: 3px;
        font-weight: 500;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .list-item-meta {
        font-size: 12px;
        color: var(--text-light);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .list-item-size {
        font-size: 13px;
        color: var(--text-light);
        flex-shrink: 0;
        padding-left: 15px;
      }

      /* ==================== ÁΩëÊ†ºËßÜÂõæ ==================== */
      .grid-view {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 15px;
      }

      .grid-item {
        background: rgba(164, 181, 213, 0.05);
        border: 1px solid var(--border-color);
        border-radius: var(--border-radius);
        padding: 20px 15px;
        text-align: center;
        transition: var(--transition);
        cursor: pointer;
      }

      .grid-item:hover {
        background: rgba(164, 181, 213, 0.1);
        border-color: var(--primary-color);
        transform: translateY(-5px);
        box-shadow: var(--shadow);
      }

      .grid-item-icon {
        font-size: 48px;
        margin-bottom: 12px;
        display: block;
      }

      .grid-item-name {
        font-size: 13px;
        color: var(--text-color);
        word-break: break-word;
        margin-bottom: 8px;
        font-weight: 500;
        line-height: 1.4;
      }

      .grid-item-meta {
        font-size: 11px;
        color: var(--text-light);
      }

      /* ==================== ÂõæË°®Âå∫Âüü ==================== */
      .charts-section {
        margin-top: var(--spacing-xl);
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: var(--spacing-lg);
      }

      .chart-card {
        background: rgba(164, 181, 213, 0.05);
        border-radius: var(--border-radius);
        padding: var(--spacing-lg);
        border: 1px solid var(--border-color);
        transition: var(--transition);
      }

      .chart-card:hover {
        border-color: var(--primary-color);
        box-shadow: var(--shadow-card);
      }

      .chart-title {
        font-size: 15px;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .chart-content {
        min-height: 200px;
      }

      .chart-bar {
        margin-bottom: 12px;
      }

      .chart-bar-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 6px;
        font-size: 12px;
      }

      .chart-bar-label {
        color: var(--text-color);
        font-weight: 500;
      }

      .chart-bar-value {
        color: var(--text-light);
      }

      .chart-bar-track {
        background: rgba(164, 181, 213, 0.2);
        height: 8px;
        border-radius: 4px;
        overflow: hidden;
      }

      .chart-bar-fill {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: 4px;
        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* ==================== ÂØºÂá∫Êìç‰Ωú ==================== */
      .export-actions {
        margin-top: var(--spacing-xl);
        padding-top: var(--spacing-xl);
        border-top: 1px solid var(--border-color);
      }

      .export-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
        margin-top: var(--spacing-md);
      }

      .export-btn {
        padding: 14px 20px;
        border: none;
        border-radius: var(--border-radius);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        user-select: none;
        white-space: nowrap;
      }

      .export-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
      }

      .export-btn:active {
        transform: translateY(0);
      }

      .export-btn-primary {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--accent-color)
        );
        color: white;
        box-shadow: var(--shadow-card);
      }

      .export-btn-secondary {
        background: linear-gradient(
          135deg,
          var(--secondary-color),
          var(--accent-color)
        );
        color: white;
        box-shadow: var(--shadow-card);
      }

      .export-btn-icon {
        font-size: 18px;
      }

      /* ==================== ToastÈÄöÁü• ==================== */
      .toast {
        position: fixed;
        top: calc(20px + var(--safe-area-top));
        right: calc(20px + var(--safe-area-right));
        background: var(--bg-color);
        padding: 16px 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-hover);
        display: flex;
        align-items: center;
        gap: 12px;
        z-index: 10000;
        transform: translateX(400px);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        max-width: 400px;
        border: 1px solid var(--border-color);
      }

      .toast.show {
        transform: translateX(0);
      }

      .toast-icon {
        font-size: 24px;
        flex-shrink: 0;
      }

      .toast-content {
        flex: 1;
        min-width: 0;
      }

      .toast-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 3px;
      }

      .toast-message {
        font-size: 12px;
        color: var(--text-light);
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .toast-close {
        background: none;
        border: none;
        color: var(--text-light);
        cursor: pointer;
        font-size: 20px;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: var(--transition);
        flex-shrink: 0;
      }

      .toast-close:hover {
        background: rgba(164, 181, 213, 0.1);
        color: var(--text-color);
      }

      /* ==================== Âä†ËΩΩÂä®Áîª ==================== */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        padding: 20px;
      }

      .loading-overlay.active {
        display: flex;
      }

      .loading-content {
        background: var(--bg-color);
        padding: 40px;
        border-radius: var(--border-radius-lg);
        text-align: center;
        box-shadow: var(--shadow-hover);
        max-width: 300px;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(164, 181, 213, 0.3);
        border-radius: 50%;
        border-top-color: var(--primary-color);
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loading-text {
        font-size: 16px;
        color: var(--text-color);
        font-weight: 500;
      }

      /* ==================== ÁßªÂä®Á´ØËèúÂçïÊåâÈíÆ ==================== */
      .mobile-menu-btn {
        display: none;
        position: fixed;
        top: calc(15px + var(--safe-area-top));
        left: calc(15px + var(--safe-area-left));
        z-index: 1001;
        width: 50px;
        height: 50px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--accent-color)
        );
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        padding: 0;
        box-shadow: var(--shadow-hover);
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 5px;
        transition: var(--transition);
      }

      .mobile-menu-btn:active {
        transform: scale(0.95);
      }

      .mobile-menu-btn span {
        display: block;
        width: 24px;
        height: 3px;
        background: white;
        border-radius: 2px;
        transition: var(--transition);
      }

      .mobile-menu-btn.active span:nth-child(1) {
        transform: rotate(45deg) translate(7px, 7px);
      }

      .mobile-menu-btn.active span:nth-child(2) {
        opacity: 0;
      }

      .mobile-menu-btn.active span:nth-child(3) {
        transform: rotate(-45deg) translate(7px, -7px);
      }

      /* ==================== ‰æßËæπÊ†èÈÅÆÁΩ© ==================== */
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(2px);
        z-index: 999;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .sidebar-overlay.active {
        display: block;
        opacity: 1;
      }

      /* ==================== ÂéÜÂè≤ËÆ∞ÂΩï ==================== */
      .history-section {
        margin-top: var(--spacing-xl);
        padding-top: var(--spacing-xl);
        border-top: 1px solid var(--border-color);
      }

      .history-list {
        max-height: 300px;
        overflow-y: auto;
      }

      .history-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px;
        background: rgba(164, 181, 213, 0.05);
        border-radius: var(--border-radius);
        margin-bottom: 8px;
        transition: var(--transition);
        cursor: pointer;
        gap: 12px;
      }

      .history-item:hover {
        background: rgba(164, 181, 213, 0.1);
        transform: translateX(5px);
      }

      .history-info {
        flex: 1;
        min-width: 0;
      }

      .history-name {
        font-size: 13px;
        color: var(--text-color);
        margin-bottom: 3px;
        font-weight: 500;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .history-time {
        font-size: 11px;
        color: var(--text-light);
      }

      .history-delete {
        background: none;
        border: none;
        color: var(--text-light);
        cursor: pointer;
        font-size: 18px;
        padding: 5px;
        transition: var(--transition);
        border-radius: 50%;
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .history-delete:hover {
        background: rgba(255, 0, 0, 0.1);
        color: #ff4444;
      }

      /* ==================== Â∑•ÂÖ∑ÊèêÁ§∫ ==================== */
      [data-tooltip] {
        position: relative;
      }

      [data-tooltip]:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: calc(100% + 8px);
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        white-space: nowrap;
        z-index: 1000;
        pointer-events: none;
        animation: tooltipFadeIn 0.2s ease;
      }

      [data-tooltip]:hover::before {
        content: "";
        position: absolute;
        bottom: calc(100% + 2px);
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-top-color: rgba(0, 0, 0, 0.9);
        z-index: 1000;
        pointer-events: none;
        animation: tooltipFadeIn 0.2s ease;
      }

      @keyframes tooltipFadeIn {
        from {
          opacity: 0;
          transform: translateX(-50%) translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateX(-50%) translateY(0);
        }
      }

      /* ==================== ÊâìÂç∞Ê†∑Âºè ==================== */
      @media print {
        body {
          background: white;
          padding: 0;
        }

        .mobile-menu-btn,
        .sidebar-overlay,
        .header-actions,
        .quick-actions,
        .search-bar,
        .filter-section,
        .export-actions,
        .toast,
        .loading-overlay,
        .history-section {
          display: none !important;
        }

        .app-wrapper {
          padding: 20px;
        }

        .main-layout {
          grid-template-columns: 1fr;
        }

        .sidebar {
          display: none;
        }

        .content-area {
          box-shadow: none;
          border: 1px solid #ddd;
        }

        .tree-view,
        .list-view,
        .grid-view {
          max-height: none;
          overflow: visible;
        }

        * {
          color: black !important;
          background: white !important;
        }

        .tree-folder {
          font-weight: bold;
        }
      }

      /* ==================== ÂìçÂ∫îÂºèËÆæËÆ° ==================== */

      /* Â§ßÂ±èÂπï‰ºòÂåñ (1400px+) */
      @media (min-width: 1400px) {
        .stats-grid {
          grid-template-columns: repeat(4, 1fr);
        }

        .charts-section {
          grid-template-columns: repeat(2, 1fr);
        }

        .export-grid {
          grid-template-columns: repeat(6, 1fr);
        }
      }

      /* Âπ≥ÊùøÊ®™Â±è (1024px - 1399px) */
      @media (max-width: 1399px) {
        :root {
          --sidebar-width: 280px;
        }

        .logo-title {
          font-size: 24px;
        }

        .content-area {
          padding: var(--spacing-lg);
        }
      }

      /* Âπ≥ÊùøÁ´ñÂ±è (768px - 1023px) */
      @media (max-width: 1023px) {
        :root {
          --sidebar-width: 260px;
          --spacing-xl: 20px;
        }

        .app-wrapper {
          padding: var(--spacing-md);
        }

        .header {
          padding: var(--spacing-lg);
        }

        .logo-icon {
          font-size: 40px;
        }

        .logo-title {
          font-size: 22px;
        }

        .logo-subtitle {
          font-size: 12px;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
        }

        .charts-section {
          grid-template-columns: 1fr;
        }

        .export-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      /* ÁßªÂä®Á´Ø (ÊúÄÂ§ß 767px) */
      @media (max-width: 767px) {
        :root {
          --spacing-lg: 12px;
          --spacing-xl: 20px;
        }

        body {
          overflow-x: hidden;
        }

        .app-wrapper {
          padding: var(--spacing-sm);
          padding-top: calc(70px + var(--safe-area-top));
        }

        /* ÊòæÁ§∫ÁßªÂä®Á´ØËèúÂçïÊåâÈíÆ */
        .mobile-menu-btn {
          display: flex;
        }

        /* Â§¥ÈÉ®‰ºòÂåñ */
        .header {
          padding: var(--spacing-md);
        }

        .header-content {
          flex-direction: column;
          align-items: stretch;
        }

        .logo-section {
          min-width: auto;
        }

        .logo-icon {
          font-size: 36px;
        }

        .logo-title {
          font-size: 20px;
        }

        .logo-subtitle {
          font-size: 11px;
        }

        .header-actions {
          width: 100%;
          justify-content: center;
        }

        .theme-switcher {
          flex: 1;
          justify-content: space-around;
        }

        .theme-btn {
          width: 36px;
          height: 36px;
          font-size: 18px;
        }

        /* ‰∏ªÂ∏ÉÂ±ÄÊîπ‰∏∫ÂçïÂàó */
        .main-layout {
          grid-template-columns: 1fr;
          gap: var(--spacing-md);
        }

        /* ‰æßËæπÊ†èÂèò‰∏∫ÊäΩÂ±â */
        .sidebar {
          position: fixed;
          left: 0;
          top: 0;
          width: 280px;
          max-width: 85vw;
          height: 100vh;
          max-height: 100vh;
          transform: translateX(-100%);
          transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          z-index: 1000;
          border-radius: 0 var(--border-radius-lg) var(--border-radius-lg) 0;
          box-shadow: 2px 0 20px rgba(0, 0, 0, 0.2);
        }

        .sidebar.active {
          transform: translateX(0);
        }

        /* ÂÜÖÂÆπÂå∫Âüü‰ºòÂåñ */
        .content-area {
          padding: var(--spacing-md);
        }

        /* ÁªüËÆ°Âç°Áâá */
        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: var(--spacing-sm);
        }

        .stat-card {
          padding: var(--spacing-sm);
        }

        .stat-icon {
          font-size: 28px;
          margin-bottom: 6px;
        }

        .stat-value {
          font-size: 20px;
        }

        .stat-label {
          font-size: 10px;
        }

        /* ËßÜÂõæÂàáÊç¢ */
        .view-modes {
          width: 100%;
        }

        .view-mode-btn {
          flex: 1;
          padding: 8px 12px;
          font-size: 12px;
        }

        /* ÊêúÁ¥¢Ê†è */
        .search-bar {
          padding: 8px 12px;
        }

        .search-input {
          font-size: 13px;
        }

        /* ËøáÊª§Âô® */
        .filter-tags {
          gap: 6px;
        }

        .filter-tag {
          padding: 5px 10px;
          font-size: 11px;
        }

        /* Âø´ÈÄüÊìç‰Ωú */
        .quick-actions {
          grid-template-columns: repeat(2, 1fr);
          gap: 8px;
        }

        .quick-btn {
          padding: 10px 12px;
          font-size: 12px;
        }

        /* ÂØºÂá∫ÊåâÈíÆ */
        .export-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }

        .export-btn {
          padding: 12px 16px;
          font-size: 13px;
        }

        /* Ê†ëÂΩ¢ËßÜÂõæ */
        .tree-view {
          font-size: 12px;
          padding: var(--spacing-md);
          line-height: 1.6;
        }

        /* ÂàóË°®ËßÜÂõæ */
        .list-item {
          padding: 10px 12px;
          font-size: 13px;
        }

        .list-item-icon {
          font-size: 20px;
        }

        .list-item-name {
          font-size: 13px;
        }

        .list-item-meta {
          font-size: 11px;
        }

        /* ÁΩëÊ†ºËßÜÂõæ */
        .grid-view {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }

        .grid-item {
          padding: 15px 10px;
        }

        .grid-item-icon {
          font-size: 40px;
        }

        .grid-item-name {
          font-size: 12px;
        }

        /* ToastÈÄöÁü• */
        .toast {
          left: calc(10px + var(--safe-area-left));
          right: calc(10px + var(--safe-area-right));
          top: calc(10px + var(--safe-area-top));
          max-width: calc(100% - 20px);
        }

        /* ÂõæË°® */
        .charts-section {
          grid-template-columns: 1fr;
          gap: var(--spacing-md);
        }

        .chart-card {
          padding: var(--spacing-md);
        }

        /* Á©∫Áä∂ÊÄÅ */
        .empty-state {
          padding: 60px 20px;
        }

        .empty-icon {
          font-size: 60px;
        }

        .empty-title {
          font-size: 16px;
        }

        .empty-text {
          font-size: 13px;
        }
      }

      /* Â∞èÂ±èÊâãÊú∫ (ÊúÄÂ§ß 480px) */
      @media (max-width: 480px) {
        .app-wrapper {
          padding: 5px;
          padding-top: calc(65px + var(--safe-area-top));
        }

        .header {
          padding: var(--spacing-sm);
        }

        .logo-icon {
          font-size: 32px;
        }

        .logo-title {
          font-size: 18px;
        }

        .content-area {
          padding: var(--spacing-sm);
        }

        /* ÁªüËÆ°Âç°ÁâáÂçïÂàó */
        .stats-grid {
          grid-template-columns: 1fr;
          gap: 8px;
        }

        /* Âø´ÈÄüÊìç‰ΩúÂçïÂàó */
        .quick-actions {
          grid-template-columns: 1fr;
        }

        /* ÂØºÂá∫ÊåâÈíÆÂçïÂàó */
        .export-grid {
          grid-template-columns: 1fr;
        }

        /* ÁΩëÊ†ºËßÜÂõæÂçïÂàó */
        .grid-view {
          grid-template-columns: 1fr;
        }

        /* ËøáÊª§Ê†áÁ≠æÊõ¥Â∞è */
        .filter-tag {
          padding: 4px 8px;
          font-size: 10px;
        }

        /* ‰æßËæπÊ†èÊõ¥Á™Ñ */
        .sidebar {
          width: 260px;
        }
      }

      /* Ê®™Â±èÊ®°Âºè‰ºòÂåñ */
      @media (max-width: 767px) and (orientation: landscape) {
        .app-wrapper {
          padding-top: calc(60px + var(--safe-area-top));
        }

        .mobile-menu-btn {
          width: 44px;
          height: 44px;
        }

        .mobile-menu-btn span {
          width: 20px;
          height: 2px;
        }

        .sidebar {
          width: 240px;
        }

        .stats-grid {
          grid-template-columns: repeat(4, 1fr);
        }

        .empty-state {
          padding: 40px 20px;
        }

        .empty-icon {
          font-size: 50px;
        }
      }

      /* Ëß¶Êë∏ËÆæÂ§á‰ºòÂåñ */
      @media (hover: none) and (pointer: coarse) {
        /* Â¢ûÂ§ßÂèØÁÇπÂáªÂå∫Âüü */
        .btn,
        .filter-tag,
        .view-mode-btn,
        .theme-btn,
        .quick-btn,
        .export-btn {
          min-height: 44px;
          min-width: 44px;
        }

        .tree-item,
        .list-item,
        .grid-item {
          min-height: 44px;
        }

        /* ÁßªÈô§hoverÊïàÊûú */
        .btn:hover,
        .filter-tag:hover,
        .view-mode-btn:hover,
        .theme-btn:hover,
        .quick-btn:hover,
        .export-btn:hover,
        .tree-item:hover,
        .list-item:hover,
        .grid-item:hover {
          transform: none;
        }

        /* Ê∑ªÂä†activeÊïàÊûú */
        .btn:active,
        .filter-tag:active,
        .view-mode-btn:active,
        .theme-btn:active,
        .quick-btn:active,
        .export-btn:active {
          transform: scale(0.95);
          opacity: 0.8;
        }
      }

      /* ÈîÆÁõòÂØºËà™ÊîØÊåÅ */
      body.keyboard-nav *:focus {
        outline: 2px solid var(--primary-color) !important;
        outline-offset: 2px;
      }

      /* Âä®ÁîªÊÄßËÉΩ‰ºòÂåñ */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* ==================== Â∑•ÂÖ∑Á±ª ==================== */

      /* ÈöêËóèÂÖÉÁ¥†ÔºàÊõø‰ª£ inline style="display:none"Ôºâ */
      .is-hidden {
        display: none;
      }

      /* Â±ÇÁ∫ßÊéßÂà∂ÂåÖË£πÂô® */
      .depth-control {
        padding-left: 28px;
        margin-top: 8px;
      }

      .depth-control label {
        font-size: 12px;
        color: var(--text-light);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* ËßÜËßâÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ•Ê°Ü */
      .visually-hidden-input {
        position: absolute;
        width: 1px;
        height: 1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }
    </style>
  </head>
  <body data-theme="morandi">
    <!-- ÁßªÂä®Á´ØËèúÂçïÊåâÈíÆ -->
    <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="ÊâìÂºÄËèúÂçï">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <!-- ‰æßËæπÊ†èÈÅÆÁΩ© -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Âä†ËΩΩÂä®Áîª -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <div class="loading-text">Ê≠£Âú®Â§ÑÁêÜÊñá‰ª∂...</div>
      </div>
    </div>

    <!-- ToastÈÄöÁü• -->
    <div class="toast" id="toast">
      <div class="toast-icon" id="toastIcon">‚úÖ</div>
      <div class="toast-content">
        <div class="toast-title" id="toastTitle">ÊàêÂäü</div>
        <div class="toast-message" id="toastMessage">Êìç‰ΩúÂÆåÊàê</div>
      </div>
      <button class="toast-close" id="toastClose" aria-label="ÂÖ≥Èó≠">√ó</button>
    </div>

    <!-- ‰∏ªÂ∫îÁî®ÂÆπÂô® -->
    <div class="app-wrapper">
      <div class="app-container">
        <!-- Â§¥ÈÉ® -->
        <header class="header">
          <div class="header-content">
            <div class="logo-section">
              <span class="logo-icon">üìä</span>
              <div class="logo-text">
                <h1 class="logo-title">Êñá‰ª∂Â§πÁªìÊûÑÂàÜÊûêÂ∑•ÂÖ∑ Pro</h1>
                <div class="logo-subtitle">
                  Êô∫ËÉΩÂàÜÊûê ¬∑ Â§öÊ†ºÂºèÂØºÂá∫ ¬∑ ÂèØËßÜÂåñÁªüËÆ°
                </div>
              </div>
            </div>
            <div class="header-actions">
              <div class="theme-switcher">
                <button
                  class="theme-btn active"
                  data-theme="morandi"
                  title="Ëé´ÂÖ∞Ëø™‰∏ªÈ¢ò"
                  aria-label="Ëé´ÂÖ∞Ëø™‰∏ªÈ¢ò"
                >
                  üé®
                </button>
                <button
                  class="theme-btn"
                  data-theme="dark"
                  title="Ê∑±Ëâ≤‰∏ªÈ¢ò"
                  aria-label="Ê∑±Ëâ≤‰∏ªÈ¢ò"
                >
                  üåô
                </button>
                <button
                  class="theme-btn"
                  data-theme="light"
                  title="ÊµÖËâ≤‰∏ªÈ¢ò"
                  aria-label="ÊµÖËâ≤‰∏ªÈ¢ò"
                >
                  ‚òÄÔ∏è
                </button>
                <button
                  class="theme-btn"
                  data-theme="rainbow"
                  title="ÂΩ©Ëôπ‰∏ªÈ¢ò"
                  aria-label="ÂΩ©Ëôπ‰∏ªÈ¢ò"
                >
                  üåà
                </button>
              </div>
            </div>
          </div>
        </header>

        <!-- ‰∏ªÂ∏ÉÂ±Ä -->
        <div class="main-layout">
          <!-- ‰æßËæπÊ†è -->
          <aside class="sidebar" id="sidebar">
            <!-- Êñá‰ª∂ÈÄâÊã© -->
            <section class="sidebar-section">
              <h3 class="section-title">
                <span class="section-icon">üìÇ</span>
                ÈÄâÊã©Êñá‰ª∂Â§π
              </h3>
              <button class="btn btn-primary btn-full" id="selectFolderBtn">
                <span class="btn-icon">üìÅ</span>
                <span>ÈÄâÊã©Êñá‰ª∂Â§π</span>
              </button>
              <input
                type="file"
                id="folderInput"
                webkitdirectory
                directory
                multiple
                class="visually-hidden-input"
              />
            </section>

            <!-- ËøáÊª§Âô® -->
            <section class="sidebar-section">
              <h3 class="section-title">
                <span class="section-icon">üîç</span>
                ËøáÊª§Âô®
              </h3>

              <div class="filter-group">
                <label class="filter-label">Êñá‰ª∂Á±ªÂûã</label>
                <div class="filter-tags" id="filterTypes">
                  <span class="filter-tag active" data-type="all">ÂÖ®ÈÉ®</span>
                  <span class="filter-tag" data-type="folder">üìÅ Êñá‰ª∂Â§π</span>
                  <span class="filter-tag" data-type="image">üñºÔ∏è ÂõæÁâá</span>
                  <span class="filter-tag" data-type="document">üìÑ ÊñáÊ°£</span>
                  <span class="filter-tag" data-type="code">üíª ‰ª£Á†Å</span>
                  <span class="filter-tag" data-type="video">üé¨ ËßÜÈ¢ë</span>
                  <span class="filter-tag" data-type="audio">üéµ Èü≥È¢ë</span>
                </div>
              </div>

              <div class="filter-group">
                <label class="filter-label" for="filterName">ÂêçÁß∞ÂåÖÂê´</label>
                <input
                  type="text"
                  class="input"
                  id="filterName"
                  placeholder="ËæìÂÖ•ÂÖ≥ÈîÆËØç..."
                />
              </div>

              <div class="filter-group">
                <label class="filter-label">Êñá‰ª∂Â§ßÂ∞è (KB)</label>
                <div class="size-range">
                  <input
                    type="number"
                    class="input input-number"
                    id="minSize"
                    placeholder="ÊúÄÂ∞è"
                    min="0"
                  />
                  <span class="size-range-separator">-</span>
                  <input
                    type="number"
                    class="input input-number"
                    id="maxSize"
                    placeholder="ÊúÄÂ§ß"
                    min="0"
                  />
                </div>
              </div>
            </section>

            <!-- ÁªüËÆ°‰ø°ÊÅØ -->
            <section class="sidebar-section">
              <h3 class="section-title">
                <span class="section-icon">üìà</span>
                ÁªüËÆ°‰ø°ÊÅØ
              </h3>
              <div class="stats-wrapper">
                <div class="stats-grid">
                  <div class="stat-card">
                    <span class="stat-icon">üìÑ</span>
                    <div class="stat-value" id="totalFiles">0</div>
                    <div class="stat-label">Êñá‰ª∂ÊÄªÊï∞</div>
                  </div>
                  <div class="stat-card">
                    <span class="stat-icon">üìÅ</span>
                    <div class="stat-value" id="totalFolders">0</div>
                    <div class="stat-label">Êñá‰ª∂Â§π</div>
                  </div>
                  <div class="stat-card">
                    <span class="stat-icon">üíæ</span>
                    <div class="stat-value" id="totalSize">0 KB</div>
                    <div class="stat-label">ÊÄªÂ§ßÂ∞è</div>
                  </div>
                  <div class="stat-card">
                    <span class="stat-icon">üìä</span>
                    <div class="stat-value" id="maxDepth">0</div>
                    <div class="stat-label">ÊúÄÂ§ßÂ±ÇÁ∫ß</div>
                  </div>
                </div>
              </div>
            </section>

            <!-- ÂØºÂá∫ËÆæÁΩÆ -->
            <section class="sidebar-section">
              <h3 class="section-title">
                <span class="section-icon">‚öôÔ∏è</span>
                ÂØºÂá∫ËÆæÁΩÆ
              </h3>

              <div class="checkbox-wrapper">
                <input
                  type="checkbox"
                  class="checkbox"
                  id="includeSize"
                  checked
                />
                <label class="checkbox-label" for="includeSize"
                  >ÂåÖÂê´Êñá‰ª∂Â§ßÂ∞è</label
                >
              </div>

              <div class="checkbox-wrapper">
                <input type="checkbox" class="checkbox" id="includeDate" />
                <label class="checkbox-label" for="includeDate"
                  >ÂåÖÂê´‰øÆÊîπÊó•Êúü</label
                >
              </div>

              <div class="checkbox-wrapper">
                <input type="checkbox" class="checkbox" id="limitDepth" />
                <label class="checkbox-label" for="limitDepth"
                  >ÈôêÂà∂Â±ÇÁ∫ßÊ∑±Â∫¶</label
                >
              </div>

              <div class="depth-control">
                <label>
                  <span>ÊúÄÂ§ßÂ±ÇÁ∫ß:</span>
                  <input
                    type="number"
                    class="input input-number"
                    id="maxDepthLimit"
                    value="5"
                    min="1"
                    max="20"
                  />
                </label>
              </div>

              <div class="checkbox-wrapper">
                <input
                  type="checkbox"
                  class="checkbox"
                  id="sortByName"
                  checked
                />
                <label class="checkbox-label" for="sortByName"
                  >ÊåâÂêçÁß∞ÊéíÂ∫è</label
                >
              </div>
            </section>

            <!-- Âø´ÈÄüÊìç‰Ωú -->
            <section class="sidebar-section">
              <h3 class="section-title">
                <span class="section-icon">‚ö°</span>
                Âø´ÈÄüÊìç‰Ωú
              </h3>
              <div class="quick-actions">
                <button
                  class="quick-btn"
                  id="copyBtn"
                  title="Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø (Ctrl+C)"
                >
                  <span class="quick-btn-icon">üìã</span>
                  <span>Â§çÂà∂</span>
                </button>
                <button class="quick-btn" id="refreshBtn" title="Âà∑Êñ∞Êï∞ÊçÆ">
                  <span class="quick-btn-icon">üîÑ</span>
                  <span>Âà∑Êñ∞</span>
                </button>
                <button class="quick-btn" id="clearBtn" title="Ê∏ÖÈô§Êï∞ÊçÆ">
                  <span class="quick-btn-icon">üóëÔ∏è</span>
                  <span>Ê∏ÖÈô§</span>
                </button>
                <button class="quick-btn" id="printBtn" title="ÊâìÂç∞ (Ctrl+P)">
                  <span class="quick-btn-icon">üñ®Ô∏è</span>
                  <span>ÊâìÂç∞</span>
                </button>
              </div>
            </section>
          </aside>

          <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
          <main class="content-area">
            <!-- Êñá‰ª∂Â§π‰ø°ÊÅØ -->
            <div class="folder-info" id="folderInfo">
              <div class="folder-name" id="folderNameDisplay">
                <span>üìÅ</span>
                <span>Êú™ÈÄâÊã©Êñá‰ª∂Â§π</span>
              </div>
              <div class="folder-stats" id="folderStats">
                ËØ∑ÈÄâÊã©‰∏Ä‰∏™Êñá‰ª∂Â§πÂºÄÂßãÂàÜÊûê
              </div>
            </div>

            <!-- Âø´ÈÄüÊìç‰ΩúÔºàÁßªÂä®Á´ØÊòæÁ§∫Ôºâ -->
            <div class="quick-actions is-hidden" id="mobileQuickActions">
              <button class="quick-btn" data-action="copy">
                <span class="quick-btn-icon">üìã</span>
                <span>Â§çÂà∂</span>
              </button>
              <button class="quick-btn" data-action="refresh">
                <span class="quick-btn-icon">üîÑ</span>
                <span>Âà∑Êñ∞</span>
              </button>
              <button class="quick-btn" data-action="clear">
                <span class="quick-btn-icon">üóëÔ∏è</span>
                <span>Ê∏ÖÈô§</span>
              </button>
              <button class="quick-btn" data-action="print">
                <span class="quick-btn-icon">üñ®Ô∏è</span>
                <span>ÊâìÂç∞</span>
              </button>
            </div>

            <!-- ÂÜÖÂÆπÂ§¥ÈÉ® -->
            <div class="content-header">
              <div class="view-modes">
                <button
                  class="view-mode-btn active"
                  data-view="tree"
                  title="Ê†ëÂΩ¢ËßÜÂõæ"
                >
                  <span class="view-mode-icon">üå≤</span>
                  <span>Ê†ëÂΩ¢</span>
                </button>
                <button class="view-mode-btn" data-view="list" title="ÂàóË°®ËßÜÂõæ">
                  <span class="view-mode-icon">üìã</span>
                  <span>ÂàóË°®</span>
                </button>
                <button class="view-mode-btn" data-view="grid" title="ÁΩëÊ†ºËßÜÂõæ">
                  <span class="view-mode-icon">‚äû</span>
                  <span>ÁΩëÊ†º</span>
                </button>
              </div>
            </div>

            <!-- ÊêúÁ¥¢Ê†è -->
            <div class="search-bar">
              <span class="search-icon">üîç</span>
              <input
                type="text"
                class="search-input"
                id="searchInput"
                placeholder="ÊêúÁ¥¢Êñá‰ª∂ÊàñÊñá‰ª∂Â§π... (Ctrl+F)"
              />
              <button
                class="search-clear"
                id="searchClear"
                aria-label="Ê∏ÖÈô§ÊêúÁ¥¢"
              >
                √ó
              </button>
            </div>

            <!-- È¢ÑËßàÂÆπÂô® -->
            <div class="preview-container" id="previewContainer">
              <div class="empty-state">
                <div class="empty-icon">üìÅ</div>
                <div class="empty-title">ËøòÊ≤°ÊúâÈÄâÊã©Êñá‰ª∂Â§π</div>
                <div class="empty-text">ÁÇπÂáªÂ∑¶‰æß"ÈÄâÊã©Êñá‰ª∂Â§π"ÊåâÈíÆÂºÄÂßãÂàÜÊûê</div>
              </div>
            </div>

            <!-- ÂõæË°®Âå∫Âüü -->
            <div class="charts-section is-hidden" id="chartsSection">
              <div class="chart-card">
                <div class="chart-title">üìä Êñá‰ª∂Á±ªÂûãÂàÜÂ∏É</div>
                <div class="chart-content" id="typeChart"></div>
              </div>
              <div class="chart-card">
                <div class="chart-title">üìà Êñá‰ª∂Â§ßÂ∞èÂàÜÂ∏É</div>
                <div class="chart-content" id="sizeChart"></div>
              </div>
            </div>

            <!-- ÂØºÂá∫Êìç‰Ωú -->
            <div class="export-actions is-hidden" id="exportActions">
              <h3 class="section-title">
                <span class="section-icon">üíæ</span>
                ÂØºÂá∫Ê†ºÂºè
              </h3>
              <div class="export-grid">
                <button
                  class="export-btn export-btn-primary"
                  id="exportMd"
                  title="ÂØºÂá∫‰∏∫MarkdownÊ†ºÂºè"
                >
                  <span class="export-btn-icon">üìù</span>
                  <span>Markdown</span>
                </button>
                <button
                  class="export-btn export-btn-primary"
                  id="exportTxt"
                  title="ÂØºÂá∫‰∏∫Á∫ØÊñáÊú¨Ê†ºÂºè"
                >
                  <span class="export-btn-icon">üìÑ</span>
                  <span>TXT</span>
                </button>
                <button
                  class="export-btn export-btn-primary"
                  id="exportJson"
                  title="ÂØºÂá∫‰∏∫JSONÊ†ºÂºè"
                >
                  <span class="export-btn-icon">üìã</span>
                  <span>JSON</span>
                </button>
                <button
                  class="export-btn export-btn-secondary"
                  id="exportXml"
                  title="ÂØºÂá∫‰∏∫XMLÊ†ºÂºè"
                >
                  <span class="export-btn-icon">üì∞</span>
                  <span>XML</span>
                </button>
                <button
                  class="export-btn export-btn-secondary"
                  id="exportHtml"
                  title="ÂØºÂá∫‰∏∫HTMLÊ†ºÂºè"
                >
                  <span class="export-btn-icon">üåê</span>
                  <span>HTML</span>
                </button>
                <button
                  class="export-btn export-btn-secondary"
                  id="exportCsv"
                  title="ÂØºÂá∫‰∏∫CSVÊ†ºÂºè"
                >
                  <span class="export-btn-icon">üìä</span>
                  <span>CSV</span>
                </button>
              </div>
            </div>
          </main>
        </div>
      </div>
    </div>

    <script>
      /* ==================== ÂÖ®Â±ÄÂèòÈáè ==================== */
      /** @type {Object|null} Êñá‰ª∂Ê†ëÁªìÊûÑÊï∞ÊçÆ */
      let fileStructure = null;
      /** @type {'tree'|'list'|'grid'} ÂΩìÂâçËßÜÂõæÊ®°Âºè */
      let currentView = "tree";
      /** @type {Object} ÂΩìÂâçËøáÊª§Êù°‰ª∂ */
      let currentFilter = {
        type: "all",
        name: "",
        minSize: null,
        maxSize: null,
      };
      /** @type {string} ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÔºàÂ∞èÂÜôÔºâ */
      let searchQuery = "";
      /** @type {string} Ê†πÊñá‰ª∂Â§πÂêçÁß∞ */
      let folderName = "";

      /* ==================== ÁéØÂ¢ÉÊ£ÄÊµã ==================== */
      /** Âà§Êñ≠ÊòØÂê¶Âú®ÂæÆ‰ø°ÂÜÖÁΩÆÊµèËßàÂô®‰∏≠ */
      const isWeChatBrowser = /MicroMessenger/i.test(navigator.userAgent);
      /** Âà§Êñ≠ÊòØÂê¶ÊîØÊåÅ webkitdirectory Â±ûÊÄß */
      const supportsDirectoryUpload =
        "webkitdirectory" in document.createElement("input");

      /* ==================== DOMÂÖÉÁ¥† ==================== */
      const elements = {
        // ÊåâÈíÆ
        selectFolderBtn: document.getElementById("selectFolderBtn"),
        folderInput: document.getElementById("folderInput"),
        mobileMenuBtn: document.getElementById("mobileMenuBtn"),
        copyBtn: document.getElementById("copyBtn"),
        refreshBtn: document.getElementById("refreshBtn"),
        clearBtn: document.getElementById("clearBtn"),
        printBtn: document.getElementById("printBtn"),

        // ÂØºÂá∫ÊåâÈíÆ
        exportMd: document.getElementById("exportMd"),
        exportTxt: document.getElementById("exportTxt"),
        exportJson: document.getElementById("exportJson"),
        exportXml: document.getElementById("exportXml"),
        exportHtml: document.getElementById("exportHtml"),
        exportCsv: document.getElementById("exportCsv"),

        // ÂÆπÂô®
        sidebar: document.getElementById("sidebar"),
        sidebarOverlay: document.getElementById("sidebarOverlay"),
        previewContainer: document.getElementById("previewContainer"),
        folderInfo: document.getElementById("folderInfo"),
        folderNameDisplay: document.getElementById("folderNameDisplay"),
        folderStats: document.getElementById("folderStats"),
        chartsSection: document.getElementById("chartsSection"),
        exportActions: document.getElementById("exportActions"),

        // ÁªüËÆ°
        totalFiles: document.getElementById("totalFiles"),
        totalFolders: document.getElementById("totalFolders"),
        totalSize: document.getElementById("totalSize"),
        maxDepth: document.getElementById("maxDepth"),

        // ÊêúÁ¥¢ÂíåËøáÊª§
        searchInput: document.getElementById("searchInput"),
        searchClear: document.getElementById("searchClear"),
        filterName: document.getElementById("filterName"),
        minSize: document.getElementById("minSize"),
        maxSize: document.getElementById("maxSize"),

        // ËÆæÁΩÆ
        includeSize: document.getElementById("includeSize"),
        includeDate: document.getElementById("includeDate"),
        limitDepth: document.getElementById("limitDepth"),
        maxDepthLimit: document.getElementById("maxDepthLimit"),
        sortByName: document.getElementById("sortByName"),

        // ToastÂíåÂä†ËΩΩ
        toast: document.getElementById("toast"),
        toastIcon: document.getElementById("toastIcon"),
        toastTitle: document.getElementById("toastTitle"),
        toastMessage: document.getElementById("toastMessage"),
        toastClose: document.getElementById("toastClose"),
        loadingOverlay: document.getElementById("loadingOverlay"),

        // ÂõæË°®
        typeChart: document.getElementById("typeChart"),
        sizeChart: document.getElementById("sizeChart"),
      };

      /* ==================== Â∑•ÂÖ∑ÂáΩÊï∞ ==================== */

      /**
       * HTMLÂÆû‰ΩìËΩ¨‰πâÔºåÈò≤Ê≠¢XSSÊ≥®ÂÖ•
       * @param {string} str - ÈúÄË¶ÅËΩ¨‰πâÁöÑÂ≠óÁ¨¶‰∏≤
       * @returns {string} ËΩ¨‰πâÂêéÁöÑÂÆâÂÖ®Â≠óÁ¨¶‰∏≤
       */
      function escapeHtml(str) {
        const escapeMap = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#39;",
        };
        return String(str).replace(/[&<>"']/g, (c) => escapeMap[c]);
      }

      /**
       * Ê≠£ÂàôÁâπÊÆäÂ≠óÁ¨¶ËΩ¨‰πâÔºåÈò≤Ê≠¢Ê≠£ÂàôÊ≥®ÂÖ•
       * @param {string} str - ÈúÄË¶ÅËΩ¨‰πâÁöÑÂ≠óÁ¨¶‰∏≤
       * @returns {string} ËΩ¨‰πâÂêéÂèØÂÆâÂÖ®Áî®‰∫é RegExp ÊûÑÈÄ†ÁöÑÂ≠óÁ¨¶‰∏≤
       */
      function escapeRegex(str) {
        return str.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
      }

      /**
       * ÂÆâÂÖ®È´ò‰∫ÆÂåπÈÖçÊñáÊú¨ÔºàÂ∑≤ËΩ¨‰πâHTML + Ê≠£ÂàôÔºâ
       * @param {string} text - ÂéüÂßãÊñáÊú¨
       * @param {string} query - ÊêúÁ¥¢ÂÖ≥ÈîÆËØçÔºàÂ∞èÂÜôÔºâ
       * @returns {string} Â∏¶È´ò‰∫ÆÊ†áËÆ∞ÁöÑÂÆâÂÖ®HTML
       */
      function highlightText(text, query) {
        const escaped = escapeHtml(text);
        if (!query) return escaped;
        const regex = new RegExp(`(${escapeRegex(query)})`, "gi");
        return escaped.replace(regex, '<span class="highlight">$1</span>');
      }

      /**
       * Ê†ºÂºèÂåñÊñá‰ª∂Â§ßÂ∞è‰∏∫ÂèØËØªÂ≠óÁ¨¶‰∏≤
       * @param {number} bytes - Â≠óËäÇÊï∞
       * @returns {string} Ê†ºÂºèÂåñÂêéÁöÑÂ§ßÂ∞èÂ≠óÁ¨¶‰∏≤ÔºåÂ¶Ç "1.50 MB"
       */
      function formatSize(bytes) {
        if (bytes === 0) return "0 B";
        const k = 1024;
        const sizes = ["B", "KB", "MB", "GB", "TB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return (bytes / Math.pow(k, i)).toFixed(2) + " " + sizes[i];
      }

      /**
       * Ê†ºÂºèÂåñÊó∂Èó¥Êà≥‰∏∫Êú¨Âú∞ÂåñÊó•ÊúüÂ≠óÁ¨¶‰∏≤
       * @param {number} date - Êó∂Èó¥Êà≥
       * @returns {string} Ê†ºÂºèÂåñÂêéÁöÑÊó•ÊúüÂ≠óÁ¨¶‰∏≤
       */
      function formatDate(date) {
        if (!date) return "";
        const d = new Date(date);
        return d.toLocaleString("zh-CN", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      /**
       * Ê†πÊçÆÊñá‰ª∂ÂêçÂíåÁ±ªÂûãËøîÂõûEmojiÂõæÊ†á
       * @param {string} name - Êñá‰ª∂/Êñá‰ª∂Â§πÂêçÁß∞
       * @param {boolean} isDirectory - ÊòØÂê¶‰∏∫Êñá‰ª∂Â§π
       * @returns {string} EmojiÂõæÊ†áÂ≠óÁ¨¶
       */
      function getFileIcon(name, isDirectory) {
        if (isDirectory) return "üìÅ";

        const ext = name.split(".").pop().toLowerCase();
        const iconMap = {
          // ÂõæÁâá
          jpg: "üñºÔ∏è",
          jpeg: "üñºÔ∏è",
          png: "üñºÔ∏è",
          gif: "üñºÔ∏è",
          svg: "üñºÔ∏è",
          webp: "üñºÔ∏è",
          bmp: "üñºÔ∏è",
          // ÊñáÊ°£
          pdf: "üìï",
          doc: "üìò",
          docx: "üìò",
          txt: "üìÑ",
          md: "üìù",
          rtf: "üìÑ",
          xls: "üìó",
          xlsx: "üìó",
          csv: "üìä",
          ppt: "üìô",
          pptx: "üìô",
          // ‰ª£Á†Å
          js: "üíõ",
          ts: "üíô",
          jsx: "‚öõÔ∏è",
          tsx: "‚öõÔ∏è",
          html: "üåê",
          css: "üé®",
          scss: "üé®",
          sass: "üé®",
          less: "üé®",
          py: "üêç",
          java: "‚òï",
          cpp: "‚öôÔ∏è",
          c: "‚öôÔ∏è",
          cs: "üî∑",
          php: "üêò",
          rb: "üíé",
          go: "üêπ",
          rs: "ü¶Ä",
          swift: "ü¶Ö",
          json: "üìã",
          xml: "üì∞",
          yaml: "üìã",
          yml: "üìã",
          // ËßÜÈ¢ë
          mp4: "üé¨",
          avi: "üé¨",
          mov: "üé¨",
          wmv: "üé¨",
          flv: "üé¨",
          mkv: "üé¨",
          // Èü≥È¢ë
          mp3: "üéµ",
          wav: "üéµ",
          flac: "üéµ",
          aac: "üéµ",
          ogg: "üéµ",
          // ÂéãÁº©
          zip: "üì¶",
          rar: "üì¶",
          "7z": "üì¶",
          tar: "üì¶",
          gz: "üì¶",
          // ÂÖ∂‰ªñ
          exe: "‚öôÔ∏è",
          dll: "‚öôÔ∏è",
          so: "‚öôÔ∏è",
          ttf: "üî§",
          otf: "üî§",
          woff: "üî§",
          woff2: "üî§",
        };

        return iconMap[ext] || "üìÑ";
      }

      /**
       * Ëé∑ÂèñÊñá‰ª∂ÂàÜÁ±ªÁ±ªÂûã
       * @param {string} name - Êñá‰ª∂Âêç
       * @param {boolean} isDirectory - ÊòØÂê¶‰∏∫Êñá‰ª∂Â§π
       * @returns {'folder'|'image'|'document'|'code'|'video'|'audio'|'other'} Êñá‰ª∂Á±ªÂûã
       */
      function getFileType(name, isDirectory) {
        if (isDirectory) return "folder";

        const ext = name.split(".").pop().toLowerCase();
        const typeMap = {
          image: ["jpg", "jpeg", "png", "gif", "svg", "webp", "bmp", "ico"],
          document: [
            "pdf",
            "doc",
            "docx",
            "txt",
            "md",
            "rtf",
            "xls",
            "xlsx",
            "csv",
            "ppt",
            "pptx",
          ],
          code: [
            "js",
            "ts",
            "jsx",
            "tsx",
            "html",
            "css",
            "scss",
            "sass",
            "less",
            "py",
            "java",
            "cpp",
            "c",
            "cs",
            "php",
            "rb",
            "go",
            "rs",
            "swift",
            "json",
            "xml",
            "yaml",
            "yml",
          ],
          video: ["mp4", "avi", "mov", "wmv", "flv", "mkv", "webm"],
          audio: ["mp3", "wav", "flac", "aac", "ogg", "m4a"],
        };

        for (const [type, extensions] of Object.entries(typeMap)) {
          if (extensions.includes(ext)) return type;
        }

        return "other";
      }

      /**
       * ÊòæÁ§∫ToastÈÄöÁü•
       * @param {string} title - ÈÄöÁü•Ê†áÈ¢ò
       * @param {string} message - ÈÄöÁü•ÂÜÖÂÆπ
       * @param {string} [icon='‚úÖ'] - EmojiÂõæÊ†á
       */
      function showToast(title, message, icon = "‚úÖ") {
        elements.toastIcon.textContent = icon;
        elements.toastTitle.textContent = title;
        elements.toastMessage.textContent = message;
        elements.toast.classList.add("show");

        setTimeout(() => {
          elements.toast.classList.remove("show");
        }, 3000);
      }

      /**
       * ÊòæÁ§∫/ÈöêËóèÂÖ®Â±èÂä†ËΩΩÂä®Áîª
       * @param {boolean} show - ÊòØÂê¶ÊòæÁ§∫
       * @param {string} [text='Ê≠£Âú®Â§ÑÁêÜÊñá‰ª∂...'] - Âä†ËΩΩÊèêÁ§∫ÊñáÊú¨
       */
      function setLoading(show, text = "Ê≠£Âú®Â§ÑÁêÜÊñá‰ª∂...") {
        if (show) {
          elements.loadingOverlay.querySelector(".loading-text").textContent =
            text;
          elements.loadingOverlay.classList.add("active");
        } else {
          elements.loadingOverlay.classList.remove("active");
        }
      }

      /**
       * Ëß¶ÂèëÊñá‰ª∂‰∏ãËΩΩ
       * @param {string} content - Êñá‰ª∂ÂÜÖÂÆπ
       * @param {string} filename - Êñá‰ª∂Âêç
       * @param {string} [type='text/plain'] - MIMEÁ±ªÂûã
       */
      function downloadFile(content, filename, type = "text/plain") {
        const blob = new Blob([content], { type });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      /* ==================== ‰∏ªÈ¢òÂàáÊç¢ ==================== */
      document.querySelectorAll(".theme-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const theme = btn.dataset.theme;
          document.body.dataset.theme = theme;

          document
            .querySelectorAll(".theme-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          localStorage.setItem("theme", theme);
          showToast("‰∏ªÈ¢òÂ∑≤ÂàáÊç¢", `Â∑≤ÂàáÊç¢Âà∞${btn.title}`, "üé®");
        });
      });

      // Âä†ËΩΩ‰øùÂ≠òÁöÑ‰∏ªÈ¢ò
      const savedTheme = localStorage.getItem("theme") || "morandi";
      document.body.dataset.theme = savedTheme;
      document
        .querySelector(`[data-theme="${savedTheme}"]`)
        ?.classList.add("active");

      /* ==================== ÁßªÂä®Á´ØËèúÂçï ==================== */
      elements.mobileMenuBtn.addEventListener("click", () => {
        elements.sidebar.classList.toggle("active");
        elements.sidebarOverlay.classList.toggle("active");
        elements.mobileMenuBtn.classList.toggle("active");
      });

      elements.sidebarOverlay.addEventListener("click", () => {
        elements.sidebar.classList.remove("active");
        elements.sidebarOverlay.classList.remove("active");
        elements.mobileMenuBtn.classList.remove("active");
      });

      // ÁßªÂä®Á´ØÊòæÁ§∫Âø´ÈÄüÊìç‰Ωú
      if (window.innerWidth <= 767) {
        document
          .getElementById("mobileQuickActions")
          .classList.remove("is-hidden");
        document.getElementById("mobileQuickActions").style.display = "grid";
      }

      window.addEventListener("resize", () => {
        if (window.innerWidth <= 767) {
          document
            .getElementById("mobileQuickActions")
            .classList.remove("is-hidden");
          document.getElementById("mobileQuickActions").style.display = "grid";
        } else {
          document
            .getElementById("mobileQuickActions")
            .classList.add("is-hidden");
          document.getElementById("mobileQuickActions").style.display = "";
          elements.sidebar.classList.remove("active");
          elements.sidebarOverlay.classList.remove("active");
          elements.mobileMenuBtn.classList.remove("active");
        }
      });

      /* ==================== ÁßªÂä®Á´ØÂø´ÈÄüÊìç‰ΩúÔºà‰∫ã‰ª∂ÂßîÊâòÊõø‰ª£inline onclickÔºâ ==================== */
      document
        .getElementById("mobileQuickActions")
        .addEventListener("click", (e) => {
          const btn = e.target.closest("[data-action]");
          if (!btn) return;
          const actionMap = {
            copy: elements.copyBtn,
            refresh: elements.refreshBtn,
            clear: elements.clearBtn,
            print: elements.printBtn,
          };
          const target = actionMap[btn.dataset.action];
          if (target) target.click();
        });

      /* ==================== ToastÂÖ≥Èó≠ ==================== */
      elements.toastClose.addEventListener("click", () => {
        elements.toast.classList.remove("show");
      });

      /* ==================== ËßÜÂõæÂàáÊç¢ ==================== */
      document.querySelectorAll(".view-mode-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          currentView = btn.dataset.view;
          document
            .querySelectorAll(".view-mode-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          if (fileStructure) {
            renderPreview();
          }
        });
      });

      /* ==================== ÊêúÁ¥¢ÂäüËÉΩ ==================== */
      // ÊêúÁ¥¢ËæìÂÖ•Áä∂ÊÄÅÊõ¥Êñ∞ÔºàÂÆûÈôÖÊ∏≤ÊüìÁî±Â∫ïÈÉ® debouncedSearch Áªü‰∏ÄÂ§ÑÁêÜÔºâ
      elements.searchInput.addEventListener("input", (e) => {
        searchQuery = e.target.value.toLowerCase();
        elements.searchClear.classList.toggle("active", searchQuery.length > 0);
      });

      elements.searchClear.addEventListener("click", () => {
        elements.searchInput.value = "";
        searchQuery = "";
        elements.searchClear.classList.remove("active");
        if (fileStructure) {
          renderPreview();
        }
      });

      /* ==================== ËøáÊª§Âô® ==================== */
      document.querySelectorAll(".filter-tag").forEach((tag) => {
        tag.addEventListener("click", () => {
          document
            .querySelectorAll(".filter-tag")
            .forEach((t) => t.classList.remove("active"));
          tag.classList.add("active");
          currentFilter.type = tag.dataset.type;

          if (fileStructure) {
            renderPreview();
          }
        });
      });

      // ÂêçÁß∞ËøáÊª§Áä∂ÊÄÅÊõ¥Êñ∞ÔºàÂÆûÈôÖÊ∏≤ÊüìÁî±Â∫ïÈÉ® debouncedSearch Áªü‰∏ÄÂ§ÑÁêÜÔºâ
      elements.filterName.addEventListener("input", (e) => {
        currentFilter.name = e.target.value.toLowerCase();
      });

      elements.minSize.addEventListener("input", (e) => {
        currentFilter.minSize = e.target.value
          ? parseFloat(e.target.value) * 1024
          : null;
        if (fileStructure) {
          renderPreview();
        }
      });

      elements.maxSize.addEventListener("input", (e) => {
        currentFilter.maxSize = e.target.value
          ? parseFloat(e.target.value) * 1024
          : null;
        if (fileStructure) {
          renderPreview();
        }
      });

      /* ==================== Êñá‰ª∂ÈÄâÊã© ==================== */
      elements.selectFolderBtn.addEventListener("click", () => {
        elements.folderInput.click();
      });

      elements.folderInput.addEventListener("change", async (e) => {
        const files = Array.from(e.target.files);
        if (files.length === 0) return;

        setLoading(true, "Ê≠£Âú®ÂàÜÊûêÊñá‰ª∂ÁªìÊûÑ...");

        try {
          await processFiles(files);
          showToast("ÂàÜÊûêÂÆåÊàê", `ÊàêÂäüÂàÜÊûê ${files.length} ‰∏™Êñá‰ª∂`, "‚úÖ");
        } catch (error) {
          console.error("Â§ÑÁêÜÊñá‰ª∂Êó∂Âá∫Èîô:", error);
          showToast("ÂàÜÊûêÂ§±Ë¥•", error.message, "‚ùå");
        } finally {
          setLoading(false);
        }
      });

      /**
       * Â§ÑÁêÜÊñá‰ª∂ÂàóË°®ÔºåÊûÑÂª∫Ê†ëÂΩ¢ÁªìÊûÑÂπ∂Êõ¥Êñ∞UI
       * @param {File[]} files - Êñá‰ª∂ÂØπË±°Êï∞ÁªÑÔºàÂ∏¶ webkitRelativePathÔºâ
       */
      async function processFiles(files) {
        // ÊûÑÂª∫Êñá‰ª∂Ê†ëÁªìÊûÑ
        const root = { name: "", children: [], isDirectory: true, size: 0 };

        // Ëé∑ÂèñÊ†πÊñá‰ª∂Â§πÂêçÁß∞
        if (files.length > 0) {
          const firstPath = files[0].webkitRelativePath;
          folderName = firstPath.split("/")[0];
          root.name = folderName;
        }

        // Â§ÑÁêÜÊØè‰∏™Êñá‰ª∂
        for (const file of files) {
          const path = file.webkitRelativePath.split("/");
          let current = root;

          // ÈÅçÂéÜË∑ØÂæÑÔºåÊûÑÂª∫Ê†ëÁªìÊûÑ
          for (let i = 1; i < path.length; i++) {
            const name = path[i];
            const isLast = i === path.length - 1;

            if (isLast) {
              // Êñá‰ª∂ËäÇÁÇπ
              current.children.push({
                name: name,
                isDirectory: false,
                size: file.size,
                lastModified: file.lastModified,
                type: file.type,
              });
            } else {
              // Êñá‰ª∂Â§πËäÇÁÇπ
              let folder = current.children.find(
                (c) => c.name === name && c.isDirectory,
              );
              if (!folder) {
                folder = {
                  name: name,
                  children: [],
                  isDirectory: true,
                  size: 0,
                };
                current.children.push(folder);
              }
              current = folder;
            }
          }
        }

        // ÊéíÂ∫è
        if (elements.sortByName.checked) {
          sortTree(root);
        }

        // ËÆ°ÁÆóÂ§ßÂ∞èÂíåÊ∑±Â∫¶
        calculateTreeStats(root);

        fileStructure = root;

        // Êõ¥Êñ∞UI
        updateStats();
        updateFolderInfo();
        renderPreview();
        renderCharts();

        // ÊòæÁ§∫ÂØºÂá∫ÊåâÈíÆÂíåÂõæË°®
        elements.exportActions.classList.remove("is-hidden");
        elements.chartsSection.classList.remove("is-hidden");
      }

      /**
       * ÈÄíÂΩíÊéíÂ∫èÊ†ëËäÇÁÇπÔºàÊñá‰ª∂Â§π‰ºòÂÖà + Â≠óÊØçÈ°∫Â∫èÔºâ
       * @param {Object} node - Ê†ëËäÇÁÇπ
       */
      function sortTree(node) {
        if (!node.children) return;

        node.children.sort((a, b) => {
          // Êñá‰ª∂Â§π‰ºòÂÖà
          if (a.isDirectory && !b.isDirectory) return -1;
          if (!a.isDirectory && b.isDirectory) return 1;
          // ÊåâÂêçÁß∞ÊéíÂ∫è
          return a.name.localeCompare(b.name, "zh-CN");
        });

        node.children.forEach((child) => {
          if (child.isDirectory) {
            sortTree(child);
          }
        });
      }

      /**
       * ÈÄíÂΩíËÆ°ÁÆóÊ†ëÁöÑÁªüËÆ°‰ø°ÊÅØÔºàÊñá‰ª∂Êï∞„ÄÅÊñá‰ª∂Â§πÊï∞„ÄÅÊÄªÂ§ßÂ∞è„ÄÅÊúÄÂ§ßÊ∑±Â∫¶Ôºâ
       * @param {Object} node - Ê†ëËäÇÁÇπ
       * @param {number} [depth=0] - ÂΩìÂâçÊ∑±Â∫¶
       * @returns {{size: number, depth: number, files: number, folders: number}}
       */
      function calculateTreeStats(node, depth = 0) {
        if (!node.isDirectory) {
          return { size: node.size, depth: depth, files: 1, folders: 0 };
        }

        let totalSize = 0;
        let maxDepth = depth;
        let totalFiles = 0;
        let totalFolders = 0;

        if (node.children) {
          for (const child of node.children) {
            const stats = calculateTreeStats(child, depth + 1);
            totalSize += stats.size;
            maxDepth = Math.max(maxDepth, stats.depth);
            totalFiles += stats.files;
            totalFolders += stats.folders;
          }
          totalFolders += node.children.filter((c) => c.isDirectory).length;
        }

        node.size = totalSize;
        node.depth = maxDepth;
        node.fileCount = totalFiles;
        node.folderCount = totalFolders;

        return {
          size: totalSize,
          depth: maxDepth,
          files: totalFiles,
          folders: totalFolders,
        };
      }

      // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
      function updateStats() {
        if (!fileStructure) return;

        elements.totalFiles.textContent = fileStructure.fileCount || 0;
        elements.totalFolders.textContent = fileStructure.folderCount || 0;
        elements.totalSize.textContent = formatSize(fileStructure.size || 0);
        elements.maxDepth.textContent = fileStructure.depth || 0;
      }

      // Êõ¥Êñ∞Êñá‰ª∂Â§π‰ø°ÊÅØÔºàÂÆâÂÖ®ËΩ¨‰πâÈò≤Ê≠¢XSSÔºâ
      function updateFolderInfo() {
        if (!fileStructure) return;

        elements.folderInfo.classList.add("active");
        elements.folderNameDisplay.innerHTML = `<span>üìÅ</span><span>${escapeHtml(folderName)}</span>`;
        elements.folderStats.textContent = `${fileStructure.fileCount} ‰∏™Êñá‰ª∂Ôºå${fileStructure.folderCount} ‰∏™Êñá‰ª∂Â§πÔºåÊÄªÂ§ßÂ∞è ${formatSize(fileStructure.size)}`;
      }

      /**
       * Ê£ÄÊü•Âçï‰∏™ËäÇÁÇπÊòØÂê¶ÂåπÈÖçÂΩìÂâçËøáÊª§Êù°‰ª∂
       * @param {Object} node - Ê†ëËäÇÁÇπ
       * @returns {boolean}
       */
      function filterNode(node) {
        // Á±ªÂûãËøáÊª§
        if (currentFilter.type !== "all") {
          const nodeType = getFileType(node.name, node.isDirectory);
          if (nodeType !== currentFilter.type) {
            return false;
          }
        }

        // ÂêçÁß∞ËøáÊª§
        if (
          currentFilter.name &&
          !node.name.toLowerCase().includes(currentFilter.name)
        ) {
          return false;
        }

        // Â§ßÂ∞èËøáÊª§
        if (!node.isDirectory) {
          if (
            currentFilter.minSize !== null &&
            node.size < currentFilter.minSize
          ) {
            return false;
          }
          if (
            currentFilter.maxSize !== null &&
            node.size > currentFilter.maxSize
          ) {
            return false;
          }
        }

        // ÊêúÁ¥¢ËøáÊª§
        if (searchQuery && !node.name.toLowerCase().includes(searchQuery)) {
          return false;
        }

        return true;
      }

      /**
       * Ëé∑ÂèñËøáÊª§ÂêéÁöÑÊ†ëÔºàÊ∑±Êã∑Ë¥ù + ËøáÊª§Ôºâ
       * @param {Object} node - Ê†ëËäÇÁÇπ
       * @param {number} [depth=0] - ÂΩìÂâçÊ∑±Â∫¶
       * @returns {Object|null} ËøáÊª§ÂêéÁöÑÊ†ëÔºåÊó†ÂåπÈÖçËøîÂõû null
       */
      function getFilteredTree(node, depth = 0) {
        const maxDepth = elements.limitDepth.checked
          ? parseInt(elements.maxDepthLimit.value)
          : Infinity;

        if (depth > maxDepth) {
          return null;
        }

        if (!node.isDirectory) {
          return filterNode(node) ? node : null;
        }

        const filtered = {
          ...node,
          children: [],
        };

        if (node.children) {
          for (const child of node.children) {
            const filteredChild = getFilteredTree(child, depth + 1);
            if (filteredChild) {
              filtered.children.push(filteredChild);
            }
          }
        }

        // Â¶ÇÊûúÊòØÊñá‰ª∂Â§π‰∏îÊúâÂ≠êÈ°πÔºåÊàñËÄÖÊñá‰ª∂Â§πÊú¨Ë∫´ÂåπÈÖçËøáÊª§Êù°‰ª∂ÔºåÂàô‰øùÁïô
        if (
          filtered.children.length > 0 ||
          (filterNode(node) && depth <= maxDepth)
        ) {
          return filtered;
        }

        return null;
      }

      /* ==================== Ê∏≤ÊüìÈ¢ÑËßà ==================== */
      function renderPreview() {
        if (!fileStructure) return;

        const filtered = getFilteredTree(fileStructure);

        if (
          !filtered ||
          (filtered.children && filtered.children.length === 0)
        ) {
          elements.previewContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üîç</div>
                        <div class="empty-title">Ê≤°ÊúâÊâæÂà∞ÂåπÈÖçÁöÑÊñá‰ª∂</div>
                        <div class="empty-text">Â∞ùËØïË∞ÉÊï¥ËøáÊª§Êù°‰ª∂ÊàñÊêúÁ¥¢ÂÖ≥ÈîÆËØç</div>
                    </div>
                `;
          return;
        }

        switch (currentView) {
          case "tree":
            renderTreeView(filtered);
            break;
          case "list":
            renderListView(filtered);
            break;
          case "grid":
            renderGridView(filtered);
            break;
        }
      }

      // Ê†ëÂΩ¢ËßÜÂõæ
      function renderTreeView(node) {
        const lines = [];

        function buildTree(node, prefix = "", isLast = true) {
          if (!node.children || node.children.length === 0) return;

          node.children.forEach((child, index) => {
            const isLastChild = index === node.children.length - 1;
            const connector = isLastChild ? "‚îî‚îÄ‚îÄ " : "‚îú‚îÄ‚îÄ ";
            const icon = getFileIcon(child.name, child.isDirectory);

            let line = prefix + connector + icon + " " + escapeHtml(child.name);

            if (elements.includeSize.checked && !child.isDirectory) {
              line += ` (${formatSize(child.size)})`;
            }

            if (elements.includeDate.checked && child.lastModified) {
              line += ` [${formatDate(child.lastModified)}]`;
            }

            // ÂÆâÂÖ®È´ò‰∫ÆÊêúÁ¥¢ÁªìÊûú
            if (searchQuery && child.name.toLowerCase().includes(searchQuery)) {
              const regex = new RegExp(`(${escapeRegex(searchQuery)})`, "gi");
              line = line.replace(regex, '<span class="highlight">$1</span>');
            }

            lines.push(
              `<span class="tree-item ${child.isDirectory ? "tree-folder" : "tree-file"}">${line}</span>`,
            );

            if (child.isDirectory && child.children) {
              const newPrefix = prefix + (isLastChild ? "    " : "‚îÇ   ");
              buildTree(child, newPrefix, isLastChild);
            }
          });
        }

        lines.push(
          `<span class="tree-item tree-folder">üìÅ ${escapeHtml(node.name)}</span>`,
        );
        buildTree(node);

        elements.previewContainer.innerHTML = `<div class="tree-view">${lines.join("\n")}</div>`;
      }

      // ÂàóË°®ËßÜÂõæ
      function renderListView(node) {
        const items = [];

        function collectItems(node, path = "") {
          if (!node.children) return;

          node.children.forEach((child) => {
            const fullPath = path ? `${path}/${child.name}` : child.name;
            items.push({ ...child, path: fullPath });

            if (child.isDirectory && child.children) {
              collectItems(child, fullPath);
            }
          });
        }

        collectItems(node);

        const html = items
          .map((item) => {
            const icon = getFileIcon(item.name, item.isDirectory);
            const size = item.isDirectory
              ? `${item.children?.length || 0} È°π`
              : formatSize(item.size);
            const meta = item.isDirectory
              ? "Êñá‰ª∂Â§π"
              : getFileType(item.name, false);

            let name = highlightText(item.name, searchQuery);

            return `
                    <div class="list-item">
                        <div class="list-item-icon">${icon}</div>
                        <div class="list-item-info">
                            <div class="list-item-name">${name}</div>
                            <div class="list-item-meta">${escapeHtml(item.path)}</div>
                        </div>
                        <div class="list-item-size">${size}</div>
                    </div>
                `;
          })
          .join("");

        elements.previewContainer.innerHTML = `<div class="list-view">${html}</div>`;
      }

      // ÁΩëÊ†ºËßÜÂõæ
      function renderGridView(node) {
        const items = [];

        function collectItems(node) {
          if (!node.children) return;

          node.children.forEach((child) => {
            items.push(child);

            if (child.isDirectory && child.children) {
              collectItems(child);
            }
          });
        }

        collectItems(node);

        const html = items
          .map((item) => {
            const icon = getFileIcon(item.name, item.isDirectory);
            const meta = item.isDirectory
              ? `${item.children?.length || 0} È°π`
              : formatSize(item.size);

            let name = highlightText(item.name, searchQuery);

            return `
                    <div class="grid-item">
                        <div class="grid-item-icon">${icon}</div>
                        <div class="grid-item-name">${name}</div>
                        <div class="grid-item-meta">${meta}</div>
                    </div>
                `;
          })
          .join("");

        elements.previewContainer.innerHTML = `<div class="grid-view">${html}</div>`;
      }

      /* ==================== ÂõæË°®Ê∏≤Êüì ==================== */
      function renderCharts() {
        if (!fileStructure) return;

        // Êñá‰ª∂Á±ªÂûãÂàÜÂ∏É
        const typeStats = {};
        const sizeStats = {
          "< 10KB": 0,
          "10KB - 100KB": 0,
          "100KB - 1MB": 0,
          "1MB - 10MB": 0,
          "> 10MB": 0,
        };

        function analyzeNode(node) {
          if (!node.isDirectory) {
            const type = getFileType(node.name, false);
            typeStats[type] = (typeStats[type] || 0) + 1;

            const sizeKB = node.size / 1024;
            const sizeMB = sizeKB / 1024;

            if (sizeKB < 10) sizeStats["< 10KB"]++;
            else if (sizeKB < 100) sizeStats["10KB - 100KB"]++;
            else if (sizeMB < 1) sizeStats["100KB - 1MB"]++;
            else if (sizeMB < 10) sizeStats["1MB - 10MB"]++;
            else sizeStats["> 10MB"]++;
          }

          if (node.children) {
            node.children.forEach(analyzeNode);
          }
        }

        analyzeNode(fileStructure);

        // Ê∏≤ÊüìÁ±ªÂûãÂõæË°®
        renderBarChart(elements.typeChart, typeStats);

        // Ê∏≤ÊüìÂ§ßÂ∞èÂõæË°®
        renderBarChart(elements.sizeChart, sizeStats);
      }

      function renderBarChart(container, data) {
        const total = Object.values(data).reduce((a, b) => a + b, 0);

        const html = Object.entries(data)
          .sort((a, b) => b[1] - a[1])
          .map(([label, value]) => {
            const percentage =
              total > 0 ? ((value / total) * 100).toFixed(1) : 0;
            return `
                        <div class="chart-bar">
                            <div class="chart-bar-header">
                                <span class="chart-bar-label">${label}</span>
                                <span class="chart-bar-value">${value} (${percentage}%)</span>
                            </div>
                            <div class="chart-bar-track">
                                <div class="chart-bar-fill" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
          })
          .join("");

        container.innerHTML =
          html ||
          '<div style="text-align: center; color: var(--text-light); padding: 20px;">ÊöÇÊó†Êï∞ÊçÆ</div>';
      }

      /* ==================== ÂØºÂá∫ÂäüËÉΩ ==================== */

      /**
       * ÁîüÊàêÊ†ëÂΩ¢Á∫ØÊñáÊú¨ÔºàÁî®‰∫éÂØºÂá∫ÂíåÂ§çÂà∂Ôºâ
       * @param {Object} node - Ê†ëËäÇÁÇπ
       * @param {string} [prefix=''] - ÂâçÁºÄÁº©Ëøõ
       * @param {boolean} [isLast=true] - ÊòØÂê¶‰∏∫ÂêåÁ∫ßÊúÄÂêé‰∏Ä‰∏™
       * @returns {string} Ê†ëÂΩ¢Á∫ØÊñáÊú¨
       */
      function generateTreeText(node, prefix = "", isLast = true) {
        let result = "";

        if (node.name) {
          const connector = prefix ? (isLast ? "‚îî‚îÄ‚îÄ " : "‚îú‚îÄ‚îÄ ") : "";
          const icon = getFileIcon(node.name, node.isDirectory);
          result += prefix + connector + icon + " " + node.name;

          if (elements.includeSize.checked && !node.isDirectory) {
            result += ` (${formatSize(node.size)})`;
          }

          if (elements.includeDate.checked && node.lastModified) {
            result += ` [${formatDate(node.lastModified)}]`;
          }

          result += "\n";
        }

        if (node.children) {
          node.children.forEach((child, index) => {
            const isLastChild = index === node.children.length - 1;
            const newPrefix =
              prefix + (node.name ? (isLast ? "    " : "‚îÇ   ") : "");
            result += generateTreeText(child, newPrefix, isLastChild);
          });
        }

        return result;
      }

      // ÂØºÂá∫‰∏∫Markdown
      elements.exportMd.addEventListener("click", () => {
        if (!fileStructure) {
          showToast("ÂØºÂá∫Â§±Ë¥•", "ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂Â§π", "‚ùå");
          return;
        }

        let content = `# ${folderName} Êñá‰ª∂ÁªìÊûÑ\n\n`;
        content += `> ÁîüÊàêÊó∂Èó¥: ${new Date().toLocaleString("zh-CN")}\n\n`;
        content += `## ÁªüËÆ°‰ø°ÊÅØ\n\n`;
        content += `- üìÑ Êñá‰ª∂ÊÄªÊï∞: ${fileStructure.fileCount}\n`;
        content += `- üìÅ Êñá‰ª∂Â§πÊï∞: ${fileStructure.folderCount}\n`;
        content += `- üíæ ÊÄªÂ§ßÂ∞è: ${formatSize(fileStructure.size)}\n`;
        content += `- üìä ÊúÄÂ§ßÂ±ÇÁ∫ß: ${fileStructure.depth}\n\n`;
        content += `## Êñá‰ª∂ÁªìÊûÑ\n\n\`\`\`\n`;
        content += generateTreeText(fileStructure);
        content += `\`\`\`\n`;

        downloadFile(content, `${folderName}_structure.md`, "text/markdown");
        showToast("ÂØºÂá∫ÊàêÂäü", "MarkdownÊñá‰ª∂Â∑≤‰∏ãËΩΩ", "üìù");
      });

      // ÂØºÂá∫‰∏∫TXT
      elements.exportTxt.addEventListener("click", () => {
        if (!fileStructure) {
          showToast("ÂØºÂá∫Â§±Ë¥•", "ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂Â§π", "‚ùå");
          return;
        }

        let content = `${folderName} Êñá‰ª∂ÁªìÊûÑ\n`;
        content += `${"=".repeat(50)}\n\n`;
        content += `ÁîüÊàêÊó∂Èó¥: ${new Date().toLocaleString("zh-CN")}\n\n`;
        content += `ÁªüËÆ°‰ø°ÊÅØ:\n`;
        content += `- Êñá‰ª∂ÊÄªÊï∞: ${fileStructure.fileCount}\n`;
        content += `- Êñá‰ª∂Â§πÊï∞: ${fileStructure.folderCount}\n`;
        content += `- ÊÄªÂ§ßÂ∞è: ${formatSize(fileStructure.size)}\n`;
        content += `- ÊúÄÂ§ßÂ±ÇÁ∫ß: ${fileStructure.depth}\n\n`;
        content += `Êñá‰ª∂ÁªìÊûÑ:\n`;
        content += `${"-".repeat(50)}\n`;
        content += generateTreeText(fileStructure);

        downloadFile(content, `${folderName}_structure.txt`, "text/plain");
        showToast("ÂØºÂá∫ÊàêÂäü", "TXTÊñá‰ª∂Â∑≤‰∏ãËΩΩ", "üìÑ");
      });

      // ÂØºÂá∫‰∏∫JSON
      elements.exportJson.addEventListener("click", () => {
        if (!fileStructure) {
          showToast("ÂØºÂá∫Â§±Ë¥•", "ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂Â§π", "‚ùå");
          return;
        }

        const data = {
          name: folderName,
          generatedAt: new Date().toISOString(),
          stats: {
            totalFiles: fileStructure.fileCount,
            totalFolders: fileStructure.folderCount,
            totalSize: fileStructure.size,
            maxDepth: fileStructure.depth,
          },
          structure: fileStructure,
        };

        const content = JSON.stringify(data, null, 2);
        downloadFile(
          content,
          `${folderName}_structure.json`,
          "application/json",
        );
        showToast("ÂØºÂá∫ÊàêÂäü", "JSONÊñá‰ª∂Â∑≤‰∏ãËΩΩ", "üìã");
      });

      // ÂØºÂá∫‰∏∫XML
      elements.exportXml.addEventListener("click", () => {
        if (!fileStructure) {
          showToast("ÂØºÂá∫Â§±Ë¥•", "ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂Â§π", "‚ùå");
          return;
        }

        function nodeToXml(node, indent = 0) {
          const spaces = "  ".repeat(indent);
          let xml = "";

          if (node.isDirectory) {
            xml += `${spaces}<folder name="${escapeXml(node.name)}"`;
            if (elements.includeSize.checked) {
              xml += ` size="${node.size}"`;
            }
            xml += ">\n";

            if (node.children) {
              node.children.forEach((child) => {
                xml += nodeToXml(child, indent + 1);
              });
            }

            xml += `${spaces}</folder>\n`;
          } else {
            xml += `${spaces}<file name="${escapeXml(node.name)}"`;
            if (elements.includeSize.checked) {
              xml += ` size="${node.size}"`;
            }
            if (elements.includeDate.checked && node.lastModified) {
              xml += ` modified="${new Date(node.lastModified).toISOString()}"`;
            }
            xml += " />\n";
          }

          return xml;
        }

        function escapeXml(str) {
          return str.replace(/[<>&'"]/g, (c) => {
            switch (c) {
              case "<":
                return "&lt;";
              case ">":
                return "&gt;";
              case "&":
                return "&amp;";
              case "'":
                return "&apos;";
              case '"':
                return "&quot;";
            }
          });
        }

        let content = '<?xml version="1.0" encoding="UTF-8"?>\n';
        content += "<fileStructure>\n";
        content += `  <metadata>\n`;
        content += `    <generatedAt>${new Date().toISOString()}</generatedAt>\n`;
        content += `    <totalFiles>${fileStructure.fileCount}</totalFiles>\n`;
        content += `    <totalFolders>${fileStructure.folderCount}</totalFolders>\n`;
        content += `    <totalSize>${fileStructure.size}</totalSize>\n`;
        content += `    <maxDepth>${fileStructure.depth}</maxDepth>\n`;
        content += `  </metadata>\n`;
        content += nodeToXml(fileStructure, 1);
        content += "</fileStructure>";

        downloadFile(content, `${folderName}_structure.xml`, "application/xml");
        showToast("ÂØºÂá∫ÊàêÂäü", "XMLÊñá‰ª∂Â∑≤‰∏ãËΩΩ", "üì∞");
      });

      // ÂØºÂá∫‰∏∫HTML
      elements.exportHtml.addEventListener("click", () => {
        if (!fileStructure) {
          showToast("ÂØºÂá∫Â§±Ë¥•", "ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂Â§π", "‚ùå");
          return;
        }

        function nodeToHtml(node, level = 0) {
          let html = "";
          const icon = getFileIcon(node.name, node.isDirectory);

          if (node.isDirectory) {
            html += `<li class="folder">`;
            html += `<span class="folder-name">${icon} ${escapeHtml(node.name)}</span>`;
            if (node.children && node.children.length > 0) {
              html += "<ul>";
              node.children.forEach((child) => {
                html += nodeToHtml(child, level + 1);
              });
              html += "</ul>";
            }
            html += "</li>";
          } else {
            html += `<li class="file">`;
            html += `<span class="file-name">${icon} ${escapeHtml(node.name)}</span>`;
            if (elements.includeSize.checked) {
              html += ` <span class="file-size">(${formatSize(node.size)})</span>`;
            }
            html += "</li>";
          }

          return html;
        }

        const content = `<!DOCTYPE html>
                <html lang="zh-CN">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${escapeHtml(folderName)} - Êñá‰ª∂ÁªìÊûÑ</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { 
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                            padding: 40px;
                            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                            min-height: 100vh;
                        }
                        .container {
                            max-width: 1200px;
                            margin: 0 auto;
                            background: white;
                            padding: 40px;
                            border-radius: 16px;
                            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
                        }
                        h1 { 
                            color: #2c3e50;
                            margin-bottom: 10px;
                            font-size: 32px;
                        }
                        .meta {
                            color: #7f8c8d;
                            margin-bottom: 30px;
                            padding-bottom: 20px;
                            border-bottom: 2px solid #ecf0f1;
                        }
                        .stats {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                            gap: 20px;
                            margin-bottom: 30px;
                        }
                        .stat-card {
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            padding: 20px;
                            border-radius: 12px;
                            text-align: center;
                        }
                        .stat-value {
                            font-size: 28px;
                            font-weight: bold;
                            margin-bottom: 5px;
                        }
                        .stat-label {
                            font-size: 14px;
                            opacity: 0.9;
                        }
                        ul {
                            list-style: none;
                            padding-left: 20px;
                        }
                        li {
                            margin: 8px 0;
                            line-height: 1.6;
                        }
                        .folder-name {
                            font-weight: 600;
                            color: #3498db;
                            cursor: pointer;
                        }
                        .folder-name:hover {
                            text-decoration: underline;
                        }
                        .file-name {
                            color: #2c3e50;
                        }
                        .file-size {
                            color: #95a5a6;
                            font-size: 0.9em;
                        }
                        .tree {
                            background: #f8f9fa;
                            padding: 20px;
                            border-radius: 8px;
                            overflow-x: auto;
                        }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>üìä ${escapeHtml(folderName)}</h1>
                        <div class="meta">ÁîüÊàêÊó∂Èó¥: ${new Date().toLocaleString("zh-CN")}</div>
                        
                        <div class="stats">
                            <div class="stat-card">
                                <div class="stat-value">${fileStructure.fileCount}</div>
                                <div class="stat-label">üìÑ Êñá‰ª∂ÊÄªÊï∞</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${fileStructure.folderCount}</div>
                                <div class="stat-label">üìÅ Êñá‰ª∂Â§πÊï∞</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${formatSize(fileStructure.size)}</div>
                                <div class="stat-label">üíæ ÊÄªÂ§ßÂ∞è</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${fileStructure.depth}</div>
                                <div class="stat-label">üìä ÊúÄÂ§ßÂ±ÇÁ∫ß</div>
                            </div>
                        </div>
                        
                        <h2 style="margin-bottom: 20px; color: #2c3e50;">Êñá‰ª∂ÁªìÊûÑ</h2>
                        <div class="tree">
                            <ul>
                                ${nodeToHtml(fileStructure)}
                            </ul>
                        </div>
                    </div>
                    
                    <script>
                        document.querySelectorAll('.folder-name').forEach(folder => {
                            folder.addEventListener('click', function() {
                                const ul = this.nextElementSibling;
                                if (ul && ul.tagName === 'UL') {
                                    ul.style.display = ul.style.display === 'none' ? 'block' : 'none';
                                }
                            });
                        });
                    <\/script>
                </body>
                </html>`;

        downloadFile(content, `${folderName}_structure.html`, "text/html");
        showToast("ÂØºÂá∫ÊàêÂäü", "HTMLÊñá‰ª∂Â∑≤‰∏ãËΩΩ", "üåê");
      });

      // ÂØºÂá∫‰∏∫CSV
      elements.exportCsv.addEventListener("click", () => {
        if (!fileStructure) {
          showToast("ÂØºÂá∫Â§±Ë¥•", "ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂Â§π", "‚ùå");
          return;
        }

        const rows = [
          ["Ë∑ØÂæÑ", "ÂêçÁß∞", "Á±ªÂûã", "Â§ßÂ∞è(Â≠óËäÇ)", "Â§ßÂ∞è", "‰øÆÊîπÊó∂Èó¥"],
        ];

        function collectRows(node, path = "") {
          const fullPath = path ? `${path}/${node.name}` : node.name;

          if (!node.isDirectory) {
            rows.push([
              fullPath,
              node.name,
              getFileType(node.name, false),
              node.size,
              formatSize(node.size),
              node.lastModified ? formatDate(node.lastModified) : "",
            ]);
          }

          if (node.children) {
            node.children.forEach((child) => collectRows(child, fullPath));
          }
        }

        collectRows(fileStructure);

        const content = rows
          .map((row) =>
            row
              .map((cell) => `"${String(cell).replace(/"/g, '""')}"`)
              .join(","),
          )
          .join("\n");

        // Ê∑ªÂä†BOM‰ª•ÊîØÊåÅExcelÊ≠£Á°ÆÊòæÁ§∫‰∏≠Êñá
        const bom = "\uFEFF";
        downloadFile(
          bom + content,
          `${folderName}_structure.csv`,
          "text/csv;charset=utf-8",
        );
        showToast("ÂØºÂá∫ÊàêÂäü", "CSVÊñá‰ª∂Â∑≤‰∏ãËΩΩ", "üìä");
      });

      /* ==================== Âø´ÈÄüÊìç‰Ωú ==================== */

      // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
      elements.copyBtn.addEventListener("click", async () => {
        if (!fileStructure) {
          showToast("Â§çÂà∂Â§±Ë¥•", "ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂Â§π", "‚ùå");
          return;
        }

        const text = generateTreeText(fileStructure);

        try {
          await navigator.clipboard.writeText(text);
          showToast("Â§çÂà∂ÊàêÂäü", "Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø", "üìã");
        } catch (err) {
          // ÈôçÁ∫ßÊñπÊ°à
          const textarea = document.createElement("textarea");
          textarea.value = text;
          textarea.style.position = "fixed";
          textarea.style.opacity = "0";
          document.body.appendChild(textarea);
          textarea.select();

          try {
            document.execCommand("copy");
            showToast("Â§çÂà∂ÊàêÂäü", "Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø", "üìã");
          } catch (err2) {
            showToast("Â§çÂà∂Â§±Ë¥•", "ÊµèËßàÂô®‰∏çÊîØÊåÅ", "‚ùå");
          }

          document.body.removeChild(textarea);
        }
      });

      // Âà∑Êñ∞
      elements.refreshBtn.addEventListener("click", () => {
        if (!fileStructure) {
          showToast("Âà∑Êñ∞Â§±Ë¥•", "ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂Â§π", "‚ùå");
          return;
        }

        renderPreview();
        renderCharts();
        updateStats();
        showToast("Âà∑Êñ∞ÊàêÂäü", "Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞", "üîÑ");
      });

      // Ê∏ÖÈô§
      elements.clearBtn.addEventListener("click", () => {
        if (!fileStructure) {
          showToast("Ê∏ÖÈô§Â§±Ë¥•", "Ê≤°ÊúâÊï∞ÊçÆÈúÄË¶ÅÊ∏ÖÈô§", "‚ùå");
          return;
        }

        if (confirm("Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÂΩìÂâçÊï∞ÊçÆÂêóÔºü")) {
          fileStructure = null;
          folderName = "";
          elements.folderInput.value = "";

          // ÈáçÁΩÆUI
          elements.previewContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìÅ</div>
                        <div class="empty-title">ËøòÊ≤°ÊúâÈÄâÊã©Êñá‰ª∂Â§π</div>
                        <div class="empty-text">ÁÇπÂáªÂ∑¶‰æß"ÈÄâÊã©Êñá‰ª∂Â§π"ÊåâÈíÆÂºÄÂßãÂàÜÊûê</div>
                    </div>
                `;

          elements.folderInfo.classList.remove("active");
          elements.folderNameDisplay.innerHTML =
            "<span>üìÅ</span><span>Êú™ÈÄâÊã©Êñá‰ª∂Â§π</span>";
          elements.folderStats.textContent = "ËØ∑ÈÄâÊã©‰∏Ä‰∏™Êñá‰ª∂Â§πÂºÄÂßãÂàÜÊûê";

          elements.totalFiles.textContent = "0";
          elements.totalFolders.textContent = "0";
          elements.totalSize.textContent = "0 KB";
          elements.maxDepth.textContent = "0";

          elements.exportActions.classList.add("is-hidden");
          elements.chartsSection.classList.add("is-hidden");

          // ÈáçÁΩÆËøáÊª§Âô®
          elements.searchInput.value = "";
          elements.filterName.value = "";
          elements.minSize.value = "";
          elements.maxSize.value = "";
          searchQuery = "";
          currentFilter = {
            type: "all",
            name: "",
            minSize: null,
            maxSize: null,
          };

          document
            .querySelectorAll(".filter-tag")
            .forEach((t) => t.classList.remove("active"));
          document.querySelector('[data-type="all"]').classList.add("active");

          showToast("Ê∏ÖÈô§ÊàêÂäü", "Êï∞ÊçÆÂ∑≤Ê∏ÖÁ©∫", "üóëÔ∏è");
        }
      });

      // ÊâìÂç∞
      elements.printBtn.addEventListener("click", () => {
        if (!fileStructure) {
          showToast("ÊâìÂç∞Â§±Ë¥•", "ËØ∑ÂÖàÈÄâÊã©Êñá‰ª∂Â§π", "‚ùå");
          return;
        }

        window.print();
      });

      /* ==================== ÈîÆÁõòÂø´Êç∑ÈîÆ ==================== */
      document.addEventListener("keydown", (e) => {
        // Ctrl/Cmd + F: ËÅöÁÑ¶ÊêúÁ¥¢Ê°Ü
        if ((e.ctrlKey || e.metaKey) && e.key === "f") {
          e.preventDefault();
          elements.searchInput.focus();
        }

        // Ctrl/Cmd + C: Â§çÂà∂
        if (
          (e.ctrlKey || e.metaKey) &&
          e.key === "c" &&
          document.activeElement.tagName !== "INPUT"
        ) {
          e.preventDefault();
          elements.copyBtn.click();
        }

        // Ctrl/Cmd + P: ÊâìÂç∞
        if ((e.ctrlKey || e.metaKey) && e.key === "p") {
          e.preventDefault();
          elements.printBtn.click();
        }

        // Ctrl/Cmd + R: Âà∑Êñ∞
        if ((e.ctrlKey || e.metaKey) && e.key === "r") {
          e.preventDefault();
          elements.refreshBtn.click();
        }

        // ESC: ÂÖ≥Èó≠ÁßªÂä®Á´ØËèúÂçï
        if (e.key === "Escape") {
          if (elements.sidebar.classList.contains("active")) {
            elements.sidebar.classList.remove("active");
            elements.sidebarOverlay.classList.remove("active");
            elements.mobileMenuBtn.classList.remove("active");
          }
        }
      });

      /* ==================== ÈîÆÁõòÂØºËà™ÊîØÊåÅ ==================== */
      document.addEventListener("keydown", (e) => {
        if (e.key === "Tab") {
          document.body.classList.add("keyboard-nav");
        }
      });

      document.addEventListener("mousedown", () => {
        document.body.classList.remove("keyboard-nav");
      });

      /* ==================== ÊãñÊîæÊîØÊåÅ ==================== */
      const dropZone = document.body;

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.style.opacity = "0.8";
      });

      dropZone.addEventListener("dragleave", (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.style.opacity = "1";
      });

      dropZone.addEventListener("drop", async (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.style.opacity = "1";

        const items = e.dataTransfer.items;
        const files = [];

        // Â§ÑÁêÜÊãñÊîæÁöÑÊñá‰ª∂
        for (let i = 0; i < items.length; i++) {
          const item = items[i];
          if (item.kind === "file") {
            const entry = item.webkitGetAsEntry();
            if (entry && entry.isDirectory) {
              await traverseDirectory(entry, files);
            }
          }
        }

        if (files.length > 0) {
          setLoading(true, "Ê≠£Âú®ÂàÜÊûêÊñá‰ª∂ÁªìÊûÑ...");

          try {
            await processFiles(files);
            showToast("ÂàÜÊûêÂÆåÊàê", `ÊàêÂäüÂàÜÊûê ${files.length} ‰∏™Êñá‰ª∂`, "‚úÖ");
          } catch (error) {
            console.error("Â§ÑÁêÜÊñá‰ª∂Êó∂Âá∫Èîô:", error);
            showToast("ÂàÜÊûêÂ§±Ë¥•", error.message, "‚ùå");
          } finally {
            setLoading(false);
          }
        }
      });

      /**
       * ÈÄíÂΩíÈÅçÂéÜÁõÆÂΩïÔºàÁî®‰∫éÊãñÊîæ‰∏ä‰º†Ôºâ
       * @param {FileSystemEntry} entry - Êñá‰ª∂Á≥ªÁªüÊù°ÁõÆ
       * @param {File[]} files - Êî∂ÈõÜÊñá‰ª∂ÁöÑÊï∞ÁªÑ
       * @param {string} [path=''] - ÂΩìÂâçË∑ØÂæÑÂâçÁºÄ
       */
      async function traverseDirectory(entry, files, path = "") {
        if (entry.isFile) {
          return new Promise((resolve) => {
            entry.file((file) => {
              // ÂàõÂª∫Â∏¶ÊúâwebkitRelativePathÁöÑÊñá‰ª∂ÂØπË±°
              const newFile = new File([file], file.name, { type: file.type });
              Object.defineProperty(newFile, "webkitRelativePath", {
                value: path + file.name,
                writable: false,
              });
              files.push(newFile);
              resolve();
            });
          });
        } else if (entry.isDirectory) {
          const dirReader = entry.createReader();
          return new Promise((resolve) => {
            const readEntries = () => {
              dirReader.readEntries(async (entries) => {
                if (entries.length === 0) {
                  resolve();
                  return;
                }

                for (const childEntry of entries) {
                  await traverseDirectory(
                    childEntry,
                    files,
                    path + entry.name + "/",
                  );
                }

                readEntries();
              });
            };
            readEntries();
          });
        }
      }

      /* ==================== ÊÄßËÉΩ‰ºòÂåñ ==================== */

      // Èò≤ÊäñÂáΩÊï∞
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // ËäÇÊµÅÂáΩÊï∞
      function throttle(func, limit) {
        let inThrottle;
        return function (...args) {
          if (!inThrottle) {
            func.apply(this, args);
            inThrottle = true;
            setTimeout(() => (inThrottle = false), limit);
          }
        };
      }

      // ‰ºòÂåñÊêúÁ¥¢ÂíåËøáÊª§
      const debouncedSearch = debounce(() => {
        if (fileStructure) {
          renderPreview();
        }
      }, 300);

      elements.searchInput.addEventListener("input", debouncedSearch);
      elements.filterName.addEventListener("input", debouncedSearch);

      /* ==================== Êú¨Âú∞Â≠òÂÇ® ==================== */

      // ‰øùÂ≠òËÆæÁΩÆ
      function saveSettings() {
        const settings = {
          includeSize: elements.includeSize.checked,
          includeDate: elements.includeDate.checked,
          limitDepth: elements.limitDepth.checked,
          maxDepthLimit: elements.maxDepthLimit.value,
          sortByName: elements.sortByName.checked,
          currentView: currentView,
        };
        localStorage.setItem(
          "folderAnalyzerSettings",
          JSON.stringify(settings),
        );
      }

      // Âä†ËΩΩËÆæÁΩÆ
      function loadSettings() {
        const saved = localStorage.getItem("folderAnalyzerSettings");
        if (saved) {
          try {
            const settings = JSON.parse(saved);
            elements.includeSize.checked = settings.includeSize ?? true;
            elements.includeDate.checked = settings.includeDate ?? false;
            elements.limitDepth.checked = settings.limitDepth ?? false;
            elements.maxDepthLimit.value = settings.maxDepthLimit ?? 5;
            elements.sortByName.checked = settings.sortByName ?? true;

            if (settings.currentView) {
              currentView = settings.currentView;
              document.querySelectorAll(".view-mode-btn").forEach((btn) => {
                btn.classList.toggle(
                  "active",
                  btn.dataset.view === currentView,
                );
              });
            }
          } catch (e) {
            console.error("Âä†ËΩΩËÆæÁΩÆÂ§±Ë¥•:", e);
          }
        }
      }

      // ÁõëÂê¨ËÆæÁΩÆÂèòÂåñ
      [
        elements.includeSize,
        elements.includeDate,
        elements.limitDepth,
        elements.sortByName,
      ].forEach((el) => {
        el.addEventListener("change", saveSettings);
      });

      elements.maxDepthLimit.addEventListener("change", saveSettings);

      // È°µÈù¢Âä†ËΩΩÊó∂ÊÅ¢Â§çËÆæÁΩÆ
      loadSettings();

      /* ==================== ÈîôËØØÂ§ÑÁêÜ ==================== */
      window.addEventListener("error", (e) => {
        console.error("ÂÖ®Â±ÄÈîôËØØ:", e.error);
        showToast("ÂèëÁîüÈîôËØØ", "ËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï", "‚ùå");
      });

      window.addEventListener("unhandledrejection", (e) => {
        console.error("Êú™Â§ÑÁêÜÁöÑPromiseÊãíÁªù:", e.reason);
        showToast("ÂèëÁîüÈîôËØØ", "ËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï", "‚ùå");
      });

      /* ==================== ÂàùÂßãÂåñ‰∏éÂÖºÂÆπÊÄßÊ£ÄÊµã ==================== */
      window.addEventListener("load", () => {
        // Ê£ÄÊü•Âü∫Á°Ä API ÂÖºÂÆπÊÄß
        if (!window.File || !window.FileReader || !window.FileList) {
          showToast(
            "ÊµèËßàÂô®‰∏çÂÖºÂÆπ",
            "ËØ∑‰ΩøÁî®Áé∞‰ª£ÊµèËßàÂô®ÔºàChrome/Edge/SafariÔºâ",
            "‚ö†Ô∏è",
          );
          return;
        }

        // ÂæÆ‰ø°ÂÜÖÁΩÆÊµèËßàÂô®ÁâπÊÆäÊèêÁ§∫
        if (isWeChatBrowser && !supportsDirectoryUpload) {
          elements.selectFolderBtn.innerHTML =
            '<span class="btn-icon">üìÅ</span><span>ÈÄâÊã©Êñá‰ª∂</span>';
          showToast(
            "ÂæÆ‰ø°ÊµèËßàÂô®ÊèêÁ§∫",
            "ÂΩìÂâçÊµèËßàÂô®‰∏çÊîØÊåÅÈÄâÊã©Êñá‰ª∂Â§πÔºåËØ∑ÁÇπÂáªÂè≥‰∏äËßí‚Ä¶Áî®Â§ñÈÉ®ÊµèËßàÂô®ÊâìÂºÄ",
            "üì¢",
          );
          // ÂæÆ‰ø°ÁéØÂ¢É‰∏ãÁßªÈô§ webkitdirectory Â±ûÊÄßÔºåÊîπ‰∏∫Â§öÊñá‰ª∂ÈÄâÊã©
          elements.folderInput.removeAttribute("webkitdirectory");
          elements.folderInput.removeAttribute("directory");
        } else if (!supportsDirectoryUpload) {
          showToast(
            "ÊµèËßàÂô®ÈôêÂà∂",
            "ÂΩìÂâçÊµèËßàÂô®‰∏çÊîØÊåÅÊñá‰ª∂Â§πÈÄâÊã©ÔºåËØ∑‰ΩøÁî® Chrome Êàñ Edge",
            "‚ö†Ô∏è",
          );
        } else {
          // ÊòæÁ§∫Ê¨¢ËøéÊèêÁ§∫
          setTimeout(() => {
            showToast("Ê¨¢Ëøé‰ΩøÁî®", "ÈÄâÊã©Êñá‰ª∂Â§πÂºÄÂßãÂàÜÊûêÂêßÔºÅ", "üëã");
          }, 500);
        }
      });

      /* ÂõæË°®Ê†∑ÂºèÂ∑≤Áªü‰∏ÄÂú® <style> Ê†áÁ≠æ‰∏≠Áª¥Êä§ÔºåÊó†ÈúÄÂä®ÊÄÅËøΩÂä† */

      /* ==================== ÊéßÂà∂Âè∞‰ø°ÊÅØ ==================== */
      console.log(
        "%cüìä Êñá‰ª∂Â§πÁªìÊûÑÂàÜÊûêÂ∑•ÂÖ∑ Pro",
        "font-size: 20px; font-weight: bold; color: #667eea;",
      );
      console.log("%cÁâàÊú¨: 2.1.0", "font-size: 12px; color: #95a5a6;");
      console.log(
        "%cÂäüËÉΩ: Êô∫ËÉΩÂàÜÊûê ¬∑ Â§öÊ†ºÂºèÂØºÂá∫ ¬∑ ÂèØËßÜÂåñÁªüËÆ°",
        "font-size: 12px; color: #95a5a6;",
      );
      console.log(
        "%cÂø´Êç∑ÈîÆ:",
        "font-size: 14px; font-weight: bold; color: #3498db;",
      );
      console.log("  Ctrl/Cmd + F: ÊêúÁ¥¢");
      console.log("  Ctrl/Cmd + C: Â§çÂà∂");
      console.log("  Ctrl/Cmd + P: ÊâìÂç∞");
      console.log("  Ctrl/Cmd + R: Âà∑Êñ∞");
      console.log("  ESC: ÂÖ≥Èó≠ËèúÂçï");
    </script>
  </body>
</html>
